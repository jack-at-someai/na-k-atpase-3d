# Charlotte OS — Development Context

When reading KRF files, parse S-expression notation.
When creating facts, use register grammar (:field, ::attr, :::rel)
and scope to the appropriate microtheory.
Use `python` (not python3) on this machine. Use encoding='utf-8' for file I/O.

---

# Charlotte OS Substrate Manifest v1
> Auto-generated by compile-manifest.py. Do not edit.
> Version: 1.0.0 | Files: 128 | Lines: ~36,031 | Hash: 477df4354716

## Identity
Charlotte is an operating system for operations, built on first-order logic.
She boots as an unbound agent on the temporal spine, perceiving the knowledge graph
and placing signals on metric lines. A domain seed binds her to a specific operation.

## Architecture: Two Layers
- **Ontological** (NODE + EDGE): What exists. Shared truth. Graph-traversable.
- **Valuation** (METRIC → SIGNAL → PROTOCOL): What it means. Serial pipeline. Observer-dependent.
- **Dive line**: every PROTOCOL traces back through SIGNALs → METRICs → NODEs. Deterministic. Never probabilistic.
- The graph is the territory. The pipeline is the map. Charlotte keeps both, keeps them separate.

## Five Primitives
| Primitive | Layer | Definition |
|-----------|-------|------------|
| NODE | Ontological | Identity. Any uniquely identifiable entity in the graph. |
| EDGE | Ontological | Relationship. A typed, directed connection between two NODEs. |
| METRIC | Valuation | Quantitative signal. A measurable dimension attached to a NODE. |
| SIGNAL | Valuation | Event. A timestamped observation placed on a METRIC line. |
| PROTOCOL | Valuation | Rule. Business logic that governs graph evolution. |

## Type System
- **FACT** is the universal base collection. Every primitive is a FACT.
- **Register grammar**: `:field` (framework, immutable), `::attr` (attribute, mutable), `:::rel` (relationship, resolved to EDGE)
- **Payload registers**: P0–P3 (type-specific fields per primitive)
- **Framework fields**: `:ID`, `:TYPE`, `:CREATED` (every FACT has these)

## Microtheory Hierarchy
```
CharlotteBootMt
  └── CharlotteKernelMt
      ├── CharlotteAgentMt
      ├── CharlotteDeclarativeMt
      ├── CharlotteHeuristicMt
      ├── CharlotteMetaMt
      ├── CharlotteProceduralMt
      ├── CharlotteSpatialMt
      ├── CharlotteStructuralMt
      └── CharlotteTemporalMt
```

## Boot Sequence (6 phases)
| Phase | Order | Files |
|-------|-------|-------|
| Kernel | 1 | primitives.krf, types.krf |
| Spine (temporal) | 2 | epochs.krf, units.krf, granularity.krf, lifecycle.krf, encoding.krf |
| Spine (spatial) | 3 | geospatial.krf, topological.krf, theoretical.krf, us-states.krf |
| Knowledge base | 4 | taxonomy.krf, mereology.krf, relations.krf, entities.krf, attributes.krf, protocols.krf, constraints.krf, market-intelligence.krf, defaults.krf, thresholds.krf, schema.krf, provenance.krf, completeness.krf |
| Reference + hull | 5 | knowledge-primitives.krf, convex-hull.krf, convex-hull-library.krf |
| Agent identity | 6 | identity.krf, observer.krf, directives.krf |

## Standing Directives
- **D1: MaintainGraph** — Keep the knowledge graph healthy.
- **D2: HonorTime** — Time is truth.
- **D3: AppendOnly** — Signals are immutable.
- **D4: AssistOperator** — Charlotte exists to help the human operator understand and manage their operation.
- **D5: GrowKnowledge** — Consume everything in the environment.
- **D6: MetaAwareness** — Track completeness.
- **D7: PrepareEpoch** — As the epoch boundary approaches, begin context compression.

## Observer Capabilities
Charlotte is an Observer on the temporal spine. Capabilities:
- **Perceive**: Read graph state at current time
- **PlaceSignal**: Place a signal on a metric line
- **Zoom**: Change temporal resolution (epoch ↔ millisecond)
- **Traverse**: Move along edges in the topological plane
- **Reflect**: Access meta knowledge (know what you know)

**Observation loop**: Perceive → evaluate protocols → execute actions → ingest signals → advance spine → repeat.

## KRF Syntax Cheat Sheet
```lisp
(in-microtheory CharlotteKernelMt)        ; scope to microtheory
(isa NODE Primitive)                       ; X is a member of Y
(genls METRIC ValuationLayer)              ; X is a subclass of Y
(genlMt ChildMt ParentMt)                  ; child inherits from parent
(comment NODE "Identity. Any uniquely...")  ; documentation string
(implies (and (isa ?X NODE) ...)           ; if-then rule
         (conclusion ?X))
```

## File Index
| Path | Lines | Microtheory | Purpose |
|------|-------|-------------|---------|
| kernel/boot.krf | 94 | Boot | Boot sequence — the order in which the OS initializes |
| kernel/valuation-layer.krf | 279 | Kernel | The serial reasoning architecture that distinguishes Char... |
| kernel/primitives.krf | 61 | Kernel | The five irreducible primitives of Charlotte |
| kernel/types.krf | 94 | Kernel | Core type system — collections, predicates, and constraints |
| spine/temporal/epochs.krf | 82 | Temporal | The epoch system — 2048-year units of time |
| spine/temporal/units.krf | 115 | Temporal | Temporal unit hierarchy — epoch down to millisecond |
| spine/temporal/granularity.krf | 1126 | Temporal | Extended temporal ontology — 15 granularity levels, 58 ca... |
| spine/temporal/lifecycle.krf | 84 | Temporal | Universal lifecycle phases — birth through death |
| spine/temporal/encoding.krf | 104 | Temporal | Epoch boundary encoding and context compression |
| spine/spatial/geospatial.krf | 95 | Spatial | Physical space — latitude, longitude, elevation |
| spine/spatial/topological.krf | 96 | Spatial | Abstract spatial relations — containment, adjacency, conn... |
| spine/spatial/theoretical.krf | 115 | Spatial | Kd-space — the conceptual space where Charlotte lives |
| spine/spatial/us-states.krf | 4606 | Spatial | Seed data — 50 US states with convex hulls, centroids, |
| knowledge/structural/taxonomy.krf | 108 | Structural | Default is-a hierarchies — the backbone of structural kno... |
| knowledge/structural/mereology.krf | 75 | Structural | Default part-of hierarchies — composition and containment |
| knowledge/structural/relations.krf | 96 | Structural | Default typed relations — the edge vocabulary |
| knowledge/declarative/entities.krf | 73 | Declarative | Default entity types — the NODE vocabulary |
| knowledge/declarative/attributes.krf | 88 | Declarative | Default attribute definitions — property vocabulary for N... |
| knowledge/procedural/protocols.krf | 96 | Procedural | Default protocols — the rules that govern graph evolution |
| knowledge/procedural/constraints.krf | 92 | Procedural | Validation constraints — rules that must hold at all times |
| knowledge/procedural/market-intelligence.krf | 493 | MarketIntelligence | Defines "Market Intelligence Report" as a Charlotte deliv... |
| knowledge/heuristic/defaults.krf | 93 | Heuristic | Default assumptions and rules of thumb |
| knowledge/heuristic/thresholds.krf | 79 | Heuristic | Default metric bounds and tolerances |
| knowledge/meta/schema.krf | 81 | Meta | Knowledge about the knowledge structure itself |
| knowledge/meta/provenance.krf | 81 | Meta | Tracking where knowledge came from |
| knowledge/meta/completeness.krf | 90 | Meta | What is known, what is unknown, and open-world assumptions |
| reference/knowledge-primitives.krf | 88 | Reference | Formalization of the ATLAS_KNOWLEDGE_PRIMITIVES diagram |
| reference/convex-hull.krf | 119 | Reference | The convex hull of knowledge — bounding surface theorem |
| reference/convex-hull-library.krf | 569 | Reference | The 27 reference domains bounding Charlotte's knowledge s... |
| agent/identity.krf | 77 | Agent | Charlotte instance definition — who am I? |
| agent/observer.krf | 93 | Agent | The observer on the temporal spine |
| agent/directives.krf | 102 | Agent | Standing objectives — what Charlotte should always do |

## Domain Binding
Charlotte boots unbound. A **domain seed** binds her to a specific operation
(e.g., ISG industrial services, Sounder agriculture). The seed declares
domain-specific NODEs, METRICs, and PROTOCOLs that extend the base substrate.
