<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Foraging Ants — GeoParticles</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Inter', sans-serif; }

canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

.hud {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none; z-index: 2;
}
.hud-top {
  position: absolute; top: 20px; left: 24px; right: 24px;
  display: flex; align-items: center; justify-content: space-between;
  pointer-events: auto;
}
.hud-top h3 {
  font-size: 0.8rem; font-weight: 500;
  color: rgba(226,232,240,0.5); letter-spacing: 0.5px;
}
.hud-top .back-btn {
  background: none; border: 1px solid rgba(100,116,139,0.3);
  color: rgba(100,116,139,0.6); font-size: 0.65rem; font-family: 'Inter', sans-serif;
  padding: 4px 12px; border-radius: 4px; cursor: pointer; transition: all 0.2s;
}
.hud-top .back-btn:hover { color: #e2e8f0; border-color: rgba(34,211,238,0.4); }

.hud-stats {
  position: absolute; top: 20px; right: 80px;
  font-size: 0.6rem; color: rgba(100,116,139,0.4);
  font-variant-numeric: tabular-nums; line-height: 1.6; text-align: right;
  pointer-events: none;
}
.hud-stats .v { color: rgba(34,211,238,0.5); }

.hud-sliders {
  position: absolute; bottom: 24px; left: 24px;
  display: flex; gap: 20px; align-items: center; pointer-events: auto;
}
.hud-sliders label {
  display: flex; align-items: center; gap: 6px;
  font-size: 0.6rem; color: rgba(148,163,184,0.5);
  letter-spacing: 0.5px; text-transform: uppercase;
}
.hud-sliders input[type="range"] { width: 80px; accent-color: rgba(34,211,238,0.5); }
.hud-sliders .val {
  font-size: 0.6rem; color: rgba(34,211,238,0.5);
  min-width: 24px; font-variant-numeric: tabular-nums;
}

.brand-bar {
  position: absolute; bottom: 24px; right: 24px;
  display: flex; gap: 6px; pointer-events: auto; flex-wrap: wrap; justify-content: flex-end; max-width: 320px;
}
.brand-chip {
  width: 20px; height: 20px; border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.08); cursor: pointer;
  transition: all 0.2s; opacity: 0.5;
}
.brand-chip.active { opacity: 1; border-color: rgba(255,255,255,0.4); transform: scale(1.2); }
.brand-chip:hover { opacity: 0.8; }

@media (max-width: 900px) {
  .hud-sliders { flex-wrap: wrap; gap: 10px; }
  .hud-sliders input[type="range"] { width: 60px; }
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div class="hud">
  <div class="hud-top">
    <h3 id="title">Foraging Ants</h3>
    <a href="index.html" class="back-btn">GeoParticles</a>
  </div>
  <div class="hud-stats" id="stats"></div>
  <div class="hud-sliders">
    <label>Ants <input type="range" id="ctrl-ants" min="5" max="80" value="30" step="1"> <span class="val" id="val-ants">30</span></label>
    <label>Food <input type="range" id="ctrl-food" min="3" max="30" value="10" step="1"> <span class="val" id="val-food">10</span></label>
    <label>Pheromone <input type="range" id="ctrl-decay" min="0.990" max="0.9995" value="0.997" step="0.0005"> <span class="val" id="val-decay">0.997</span></label>
  </div>
  <div class="brand-bar" id="brandBar"></div>
</div>

<script>
// ═══════════════════════════════════════════════════════
// Brand Palettes (same as geoparticles)
// ═══════════════════════════════════════════════════════
const BRANDS = [
  { id: 'someai', name: 'SomeAI', primary: '#E53E3E', secondary: '#9B7878', accent: '#C4A8A8' },
  { id: 'isg', name: 'ISG', primary: '#8FAADC', secondary: '#E2A532', accent: '#90CDF4' },
  { id: 'sounder', name: 'Sounder', primary: '#F000D2', secondary: '#7200CB', accent: '#21D6C6' },
  { id: 'richard-enterprises', name: 'Richard Enterprises', primary: '#E53E3E', secondary: '#C4A8A8', accent: '#F59E0B' },
  { id: 'allstate', name: 'All State Mfg', primary: '#B8860B', secondary: '#5C4033', accent: '#D4A76A' },
  { id: 'top-tier', name: 'Top Tier Moving', primary: '#22C55E', secondary: '#2563EB', accent: '#22D3EE' },
  { id: 'cardvault', name: 'CardVault', primary: '#F59E0B', secondary: '#3B82F6', accent: '#EC4899' },
  { id: 'sc-online', name: 'SC Online Sales', primary: '#F000D2', secondary: '#7200CB', accent: '#22C55E' },
  { id: 'wendt', name: 'Wendt Group', primary: '#2563EB', secondary: '#16A34A', accent: '#F59E0B' },
  { id: 'ppp', name: 'PPP Instruments', primary: '#E53E3E', secondary: '#1A1A2E', accent: '#C4A8A8' },
];

function hexToRgb(hex) {
  const h = hex.replace('#', '');
  return [parseInt(h.substring(0, 2), 16), parseInt(h.substring(2, 4), 16), parseInt(h.substring(4, 6), 16)];
}

// ═══════════════════════════════════════════════════════
// State
// ═══════════════════════════════════════════════════════
let brand = BRANDS[0];
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

// Grid-based pheromone map
const GRID = 200; // pheromone grid resolution
let pheromoneHome = new Float32Array(GRID * GRID); // trail TO nest
let pheromoneFood = new Float32Array(GRID * GRID); // trail TO food

// Colony
let nestX, nestY;
let foods = [];
let ants = [];
let foodCollected = 0;
let frameCount = 0;

// ═══════════════════════════════════════════════════════
// Initialization
// ═══════════════════════════════════════════════════════
function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

function init() {
  resize();
  const cw = canvas.width, ch = canvas.height;
  nestX = cw * 0.5;
  nestY = ch * 0.5;
  foodCollected = 0;
  frameCount = 0;
  pheromoneHome.fill(0);
  pheromoneFood.fill(0);

  // Place food sources in a ring around the nest
  const numFood = parseInt(document.getElementById('ctrl-food').value);
  foods = [];
  for (let i = 0; i < numFood; i++) {
    const angle = (i / numFood) * Math.PI * 2 + Math.random() * 0.5;
    const dist = 150 + Math.random() * Math.min(cw, ch) * 0.3;
    foods.push({
      x: nestX + Math.cos(angle) * dist,
      y: nestY + Math.sin(angle) * dist,
      amount: 30 + Math.floor(Math.random() * 50),
      maxAmount: 80,
    });
  }
  // Clamp to screen
  for (const f of foods) {
    f.x = Math.max(40, Math.min(cw - 40, f.x));
    f.y = Math.max(40, Math.min(ch - 40, f.y));
  }

  // Spawn ants
  const numAnts = parseInt(document.getElementById('ctrl-ants').value);
  ants = [];
  for (let i = 0; i < numAnts; i++) {
    ants.push({
      x: nestX + (Math.random() - 0.5) * 20,
      y: nestY + (Math.random() - 0.5) * 20,
      angle: Math.random() * Math.PI * 2,
      hasFood: false,
      speed: 1.2 + Math.random() * 0.6,
      turnBias: (Math.random() - 0.5) * 0.3,
    });
  }
}

// ═══════════════════════════════════════════════════════
// Pheromone helpers
// ═══════════════════════════════════════════════════════
function toGrid(px, py) {
  const gx = Math.floor((px / canvas.width) * GRID);
  const gy = Math.floor((py / canvas.height) * GRID);
  return [Math.max(0, Math.min(GRID - 1, gx)), Math.max(0, Math.min(GRID - 1, gy))];
}

function samplePheromone(map, px, py) {
  const [gx, gy] = toGrid(px, py);
  return map[gy * GRID + gx];
}

function depositPheromone(map, px, py, amount) {
  const [gx, gy] = toGrid(px, py);
  map[gy * GRID + gx] = Math.min(1, map[gy * GRID + gx] + amount);
}

function senseDir(map, px, py, angle, offset) {
  const senseAngle = angle + offset;
  const senseDist = 12;
  const sx = px + Math.cos(senseAngle) * senseDist;
  const sy = py + Math.sin(senseAngle) * senseDist;
  return samplePheromone(map, sx, sy);
}

// ═══════════════════════════════════════════════════════
// Simulation step
// ═══════════════════════════════════════════════════════
function step() {
  const cw = canvas.width, ch = canvas.height;
  const decay = parseFloat(document.getElementById('ctrl-decay').value);

  // Decay pheromones
  for (let i = 0; i < GRID * GRID; i++) {
    pheromoneHome[i] *= decay;
    pheromoneFood[i] *= decay;
    if (pheromoneHome[i] < 0.001) pheromoneHome[i] = 0;
    if (pheromoneFood[i] < 0.001) pheromoneFood[i] = 0;
  }

  // Diffuse pheromones (simple 3x3 blur every 4 frames)
  if (frameCount % 4 === 0) {
    const tmpH = new Float32Array(GRID * GRID);
    const tmpF = new Float32Array(GRID * GRID);
    for (let y = 1; y < GRID - 1; y++) {
      for (let x = 1; x < GRID - 1; x++) {
        const i = y * GRID + x;
        let sh = 0, sf = 0;
        for (let dy = -1; dy <= 1; dy++) {
          for (let dx = -1; dx <= 1; dx++) {
            const j = (y + dy) * GRID + (x + dx);
            sh += pheromoneHome[j];
            sf += pheromoneFood[j];
          }
        }
        tmpH[i] = sh / 9;
        tmpF[i] = sf / 9;
      }
    }
    pheromoneHome = tmpH;
    pheromoneFood = tmpF;
  }

  for (const ant of ants) {
    // Deposit pheromone
    if (ant.hasFood) {
      depositPheromone(pheromoneFood, ant.x, ant.y, 0.15);
    } else {
      depositPheromone(pheromoneHome, ant.x, ant.y, 0.08);
    }

    // Sense pheromones — follow the trail leading to what we want
    const followMap = ant.hasFood ? pheromoneHome : pheromoneFood;
    const sL = senseDir(followMap, ant.x, ant.y, ant.angle, -0.5);
    const sC = senseDir(followMap, ant.x, ant.y, ant.angle, 0);
    const sR = senseDir(followMap, ant.x, ant.y, ant.angle, 0.5);

    // Steer towards strongest pheromone
    if (sC >= sL && sC >= sR) {
      // Keep going
    } else if (sL > sR) {
      ant.angle -= 0.15 + Math.random() * 0.1;
    } else if (sR > sL) {
      ant.angle += 0.15 + Math.random() * 0.1;
    }

    // Random wander
    ant.angle += (Math.random() - 0.5) * 0.4 + ant.turnBias * 0.05;

    // Move
    ant.x += Math.cos(ant.angle) * ant.speed;
    ant.y += Math.sin(ant.angle) * ant.speed;

    // Bounce off walls
    const margin = 5;
    if (ant.x < margin) { ant.x = margin; ant.angle = Math.PI - ant.angle; }
    if (ant.x > cw - margin) { ant.x = cw - margin; ant.angle = Math.PI - ant.angle; }
    if (ant.y < margin) { ant.y = margin; ant.angle = -ant.angle; }
    if (ant.y > ch - margin) { ant.y = ch - margin; ant.angle = -ant.angle; }

    // Pick up food
    if (!ant.hasFood) {
      for (const food of foods) {
        const dx = ant.x - food.x, dy = ant.y - food.y;
        if (dx * dx + dy * dy < 20 * 20 && food.amount > 0) {
          ant.hasFood = true;
          food.amount--;
          ant.angle += Math.PI; // turn around
          break;
        }
      }
    }

    // Deliver food to nest
    if (ant.hasFood) {
      const dx = ant.x - nestX, dy = ant.y - nestY;
      if (dx * dx + dy * dy < 15 * 15) {
        ant.hasFood = false;
        foodCollected++;
        ant.angle += Math.PI; // turn around to forage again
      }
    }
  }

  // Respawn depleted food
  for (const food of foods) {
    if (food.amount <= 0) {
      const angle = Math.random() * Math.PI * 2;
      const dist = 150 + Math.random() * Math.min(cw, ch) * 0.3;
      food.x = Math.max(40, Math.min(cw - 40, nestX + Math.cos(angle) * dist));
      food.y = Math.max(40, Math.min(ch - 40, nestY + Math.sin(angle) * dist));
      food.amount = 30 + Math.floor(Math.random() * 50);
    }
  }
}

// ═══════════════════════════════════════════════════════
// Rendering
// ═══════════════════════════════════════════════════════
function render() {
  const cw = canvas.width, ch = canvas.height;
  const pri = hexToRgb(brand.primary);
  const sec = hexToRgb(brand.secondary);
  const acc = hexToRgb(brand.accent);

  // Dark background
  ctx.fillStyle = '#000000';
  ctx.fillRect(0, 0, cw, ch);

  // Render pheromone trails
  const cellW = cw / GRID, cellH = ch / GRID;
  for (let y = 0; y < GRID; y++) {
    for (let x = 0; x < GRID; x++) {
      const i = y * GRID + x;
      const h = pheromoneHome[i];
      const f = pheromoneFood[i];
      if (h < 0.005 && f < 0.005) continue;

      const px = x * cellW, py = y * cellH;

      // Home trail — secondary color
      if (h > 0.005) {
        const a = Math.min(0.3, h * 0.4);
        ctx.fillStyle = `rgba(${sec[0]},${sec[1]},${sec[2]},${a})`;
        ctx.fillRect(px, py, cellW + 0.5, cellH + 0.5);
      }
      // Food trail — primary color (brighter, this is the main visible trail)
      if (f > 0.005) {
        const a = Math.min(0.5, f * 0.6);
        ctx.fillStyle = `rgba(${pri[0]},${pri[1]},${pri[2]},${a})`;
        ctx.fillRect(px, py, cellW + 0.5, cellH + 0.5);
      }
    }
  }

  // Nest — soft primary glow
  const nestGrad = ctx.createRadialGradient(nestX, nestY, 0, nestX, nestY, 30);
  nestGrad.addColorStop(0, `rgba(${pri[0]},${pri[1]},${pri[2]},0.25)`);
  nestGrad.addColorStop(0.5, `rgba(${pri[0]},${pri[1]},${pri[2]},0.08)`);
  nestGrad.addColorStop(1, 'rgba(0,0,0,0)');
  ctx.fillStyle = nestGrad;
  ctx.fillRect(nestX - 30, nestY - 30, 60, 60);
  // Nest dot
  ctx.fillStyle = `rgba(${pri[0]},${pri[1]},${pri[2]},0.6)`;
  ctx.shadowColor = brand.primary;
  ctx.shadowBlur = 10;
  ctx.beginPath();
  ctx.arc(nestX, nestY, 4, 0, Math.PI * 2);
  ctx.fill();
  ctx.shadowBlur = 0;

  // Food sources — accent color, pulsing
  const pulse = 0.3 + Math.sin(frameCount * 0.04) * 0.1;
  for (const food of foods) {
    const sizeFrac = food.amount / food.maxAmount;
    const r = 4 + sizeFrac * 10;
    // Glow
    const foodGrad = ctx.createRadialGradient(food.x, food.y, 0, food.x, food.y, r * 2.5);
    foodGrad.addColorStop(0, `rgba(${acc[0]},${acc[1]},${acc[2]},${pulse * sizeFrac})`);
    foodGrad.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = foodGrad;
    ctx.fillRect(food.x - r * 2.5, food.y - r * 2.5, r * 5, r * 5);
    // Dot
    ctx.fillStyle = `rgba(${acc[0]},${acc[1]},${acc[2]},${0.4 + sizeFrac * 0.4})`;
    ctx.beginPath();
    ctx.arc(food.x, food.y, r * 0.4, 0, Math.PI * 2);
    ctx.fill();
  }

  // Ants
  for (const ant of ants) {
    if (ant.hasFood) {
      // Carrying food — bright accent
      ctx.fillStyle = `rgba(${acc[0]},${acc[1]},${acc[2]},0.8)`;
      ctx.shadowColor = brand.accent;
      ctx.shadowBlur = 4;
    } else {
      // Foraging — dim primary
      ctx.fillStyle = `rgba(${pri[0]},${pri[1]},${pri[2]},0.5)`;
      ctx.shadowBlur = 0;
    }
    ctx.beginPath();
    ctx.arc(ant.x, ant.y, 1.5, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;
  }

  // HUD stats
  const statsEl = document.getElementById('stats');
  statsEl.innerHTML = `
    <div>Ants <span class="v">${ants.length}</span></div>
    <div>Food sources <span class="v">${foods.length}</span></div>
    <div>Collected <span class="v">${foodCollected}</span></div>
  `;
}

// ═══════════════════════════════════════════════════════
// Loop
// ═══════════════════════════════════════════════════════
function loop() {
  step();
  render();
  frameCount++;
  requestAnimationFrame(loop);
}

// ═══════════════════════════════════════════════════════
// Brand selector
// ═══════════════════════════════════════════════════════
function buildBrandBar() {
  const bar = document.getElementById('brandBar');
  bar.innerHTML = '';
  for (let i = 0; i < BRANDS.length; i++) {
    const b = BRANDS[i];
    const chip = document.createElement('div');
    chip.className = `brand-chip ${b.id === brand.id ? 'active' : ''}`;
    chip.style.background = b.primary;
    chip.title = b.name;
    chip.addEventListener('click', () => {
      brand = b;
      document.querySelectorAll('.brand-chip').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      document.getElementById('title').textContent = `Foraging Ants — ${b.name}`;
    });
    bar.appendChild(chip);
  }
}

// ═══════════════════════════════════════════════════════
// Controls
// ═══════════════════════════════════════════════════════
document.getElementById('ctrl-ants').addEventListener('input', function() {
  document.getElementById('val-ants').textContent = this.value;
  init();
});
document.getElementById('ctrl-food').addEventListener('input', function() {
  document.getElementById('val-food').textContent = this.value;
  init();
});
document.getElementById('ctrl-decay').addEventListener('input', function() {
  document.getElementById('val-decay').textContent = this.value;
});

window.addEventListener('resize', () => {
  resize();
  nestX = canvas.width * 0.5;
  nestY = canvas.height * 0.5;
});

// ═══════════════════════════════════════════════════════
// Boot
// ═══════════════════════════════════════════════════════
buildBrandBar();
document.getElementById('title').textContent = `Foraging Ants — ${brand.name}`;
init();
loop();
</script>
</body>
</html>
