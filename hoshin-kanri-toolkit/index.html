<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hoshin Kanri Toolkit â€” Strategy Deployment Playground</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0e17;--surface:#060910;--card:#111827;--border:#334155;
  --text:#e2e8f0;--muted:#94a3b8;--accent:#6366f1;--accent2:#22d3ee;
  --warn:#f59e0b;--danger:#f43f5e;--purple:#818cf8;
  --radius:8px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Inter', -apple-system, sans-serif;line-height:1.5;min-height:100vh}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}

/* Layout */
.topbar{background:var(--surface);border-bottom:1px solid var(--border);padding:10px 20px;display:flex;align-items:center;gap:16px;position:sticky;top:0;z-index:100}
.topbar h1{font-size:1.1rem;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;white-space:nowrap}
.topbar .sub{font-size:.72rem;color:var(--muted)}

.tabs{display:flex;gap:2px;overflow-x:auto;flex:1}
.tab{padding:6px 14px;border-radius:6px;font-size:.72rem;font-weight:600;cursor:pointer;white-space:nowrap;
  background:transparent;border:1px solid transparent;color:var(--muted);transition:all .2s}
.tab:hover{color:var(--text);background:rgba(99,102,241,.08)}
.tab.active{background:var(--accent);color:#fff;border-color:var(--accent)}

.main{max-width:1400px;margin:0 auto;padding:16px}
.page{display:none}
.page.active{display:block}

/* Cards */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:14px}
.card h2{font-size:.8rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--accent);margin-bottom:10px}
.card h3{font-size:.9rem;color:var(--text);margin-bottom:6px}
.card p,.card li{font-size:.82rem;color:var(--muted);line-height:1.55}
.card ul{padding-left:18px}.card li{margin-bottom:3px}

/* Forms */
input,textarea,select{
  background:var(--surface);border:1px solid var(--border);border-radius:6px;
  padding:6px 10px;color:var(--text);font-size:.78rem;font-family:inherit;width:100%}
input:focus,textarea:focus{outline:none;border-color:var(--accent)}
textarea{resize:vertical;min-height:60px}
label{font-size:.72rem;color:var(--muted);display:block;margin-bottom:3px}
.form-row{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
.form-row>*{flex:1;min-width:120px}

button,.btn{
  padding:7px 16px;border-radius:6px;border:1px solid var(--border);
  background:var(--surface);color:var(--text);font-size:.75rem;cursor:pointer;
  font-weight:600;transition:all .2s;font-family:inherit}
button:hover,.btn:hover{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn-sm{padding:4px 10px;font-size:.68rem}
.btn-accent{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn-accent:hover{background:#818cf8}
.btn-danger{border-color:var(--danger);color:var(--danger)}
.btn-danger:hover{background:var(--danger);color:#fff}

/* Grid */
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
@media(max-width:800px){.grid-2,.grid-3{grid-template-columns:1fr}}

/* === X-MATRIX === */
.xmatrix-wrap{position:relative;width:100%;max-width:900px;margin:0 auto;aspect-ratio:1/1}
.xmatrix-canvas{width:100%;height:100%;border-radius:var(--radius);background:var(--surface)}

/* === BOWLING CHART === */
.bowling-table{width:100%;border-collapse:collapse;font-size:.72rem}
.bowling-table th,.bowling-table td{border:1px solid var(--border);padding:5px 6px;text-align:center}
.bowling-table th{background:var(--surface);color:var(--muted);font-weight:600;position:sticky;top:0}
.bowling-table td{background:var(--card)}
.bowling-table td.target{color:var(--accent);font-weight:600}
.bowling-table td.green{background:rgba(34,211,238,.15);color:var(--accent2)}
.bowling-table td.yellow{background:rgba(245,158,11,.12);color:var(--warn)}
.bowling-table td.red{background:rgba(244,63,94,.12);color:var(--danger)}
.bowling-table td.kpi-name{text-align:left;font-weight:600;color:var(--text);min-width:120px}

/* === PDCA === */
.pdca-wrap{display:flex;justify-content:center;padding:20px 0}
.pdca-canvas{border-radius:50%}

/* === A3 === */
.a3-grid{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:auto;gap:1px;background:var(--border);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.a3-section{background:var(--card);padding:12px}
.a3-section.full-width{grid-column:1/-1}
.a3-section h3{font-size:.75rem;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}

/* === KAIZEN BOARD === */
.kaizen-cols{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
@media(max-width:900px){.kaizen-cols{grid-template-columns:repeat(2,1fr)}}
.kaizen-col{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:10px;min-height:200px}
.kaizen-col h3{font-size:.72rem;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;text-align:center;padding-bottom:6px;border-bottom:2px solid var(--border)}
.kaizen-col h3.ideas{color:var(--warn);border-color:var(--warn)}
.kaizen-col h3.planned{color:var(--accent);border-color:var(--accent)}
.kaizen-col h3.doing{color:var(--purple);border-color:var(--purple)}
.kaizen-col h3.done{color:var(--accent2);border-color:var(--accent2)}
.kaizen-card{background:var(--card);border:1px solid var(--border);border-radius:6px;padding:8px;margin-bottom:6px;font-size:.74rem;cursor:grab;transition:all .15s}
.kaizen-card:hover{border-color:var(--accent);transform:translateY(-1px)}
.kaizen-card .title{font-weight:600;color:var(--text);margin-bottom:2px}
.kaizen-card .meta{font-size:.65rem;color:var(--muted)}

/* === CATCHBALL === */
.catchball-canvas{width:100%;max-width:800px;margin:0 auto;display:block;border-radius:var(--radius)}

/* === KNOWLEDGE === */
.kb-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
.kb-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:14px;transition:border-color .2s}
.kb-card:hover{border-color:var(--accent)}
.kb-card h3{font-size:.85rem;margin-bottom:6px}
.kb-card p{font-size:.76rem;color:var(--muted)}
.kb-card .tag{display:inline-block;font-size:.6rem;padding:2px 8px;border-radius:20px;margin-top:8px;
  background:rgba(99,102,241,.12);color:var(--accent);font-weight:600}
</style>
</head>
<body>

<div class="topbar">
  <div>
    <h1>Hoshin Kanri Toolkit</h1>
    <div class="sub">Strategy Deployment Playground</div>
  </div>
  <div class="tabs" id="tabs"></div>
</div>

<div class="main" id="main"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APP FRAMEWORK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PAGES = [
  {id:'xmatrix', label:'X-Matrix', icon:''},
  {id:'pdca',    label:'PDCA Cycle'},
  {id:'bowling', label:'Bowling Chart'},
  {id:'a3',      label:'A3 Report'},
  {id:'kaizen',  label:'Kaizen Board'},
  {id:'catchball',label:'Catchball'},
  {id:'knowledge',label:'Knowledge Base'},
];

let activePage = 'xmatrix';
const tabsEl = document.getElementById('tabs');
const mainEl = document.getElementById('main');

PAGES.forEach(p => {
  const t = document.createElement('div');
  t.className = 'tab' + (p.id === activePage ? ' active' : '');
  t.textContent = p.label;
  t.dataset.id = p.id;
  t.onclick = () => switchPage(p.id);
  tabsEl.appendChild(t);
});

function switchPage(id){
  activePage = id;
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.id === id));
  renderPage(id);
}

function renderPage(id){
  switch(id){
    case 'xmatrix':  renderXMatrix(); break;
    case 'pdca':     renderPDCA(); break;
    case 'bowling':  renderBowling(); break;
    case 'a3':       renderA3(); break;
    case 'kaizen':   renderKaizen(); break;
    case 'catchball':renderCatchball(); break;
    case 'knowledge':renderKnowledge(); break;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. X-MATRIX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const xData = {
  vision: 'Become the market leader in sustainable manufacturing by 2028',
  breakthroughs: [
    'Achieve zero-waste production across all facilities',
    'Launch 3 new sustainable product lines',
    'Reduce carbon footprint by 60%',
  ],
  annuals: [
    'Implement waste tracking in 4 plants',
    'Complete R&D for first sustainable product',
    'Transition 30% energy to renewables',
    'Train 500 employees in lean practices',
  ],
  priorities: [
    'Deploy IoT waste sensors',
    'Green product R&D sprint',
    'Solar panel installation Phase 1',
    'Lean certification program',
    'Supplier sustainability audit',
  ],
  metrics: [
    {name:'Waste reduction %', owner:'VP Ops'},
    {name:'New products in pipeline', owner:'VP R&D'},
    {name:'Renewable energy %', owner:'Facilities Dir'},
    {name:'Employees certified', owner:'HR Dir'},
    {name:'Supplier compliance %', owner:'Procurement'},
  ],
  // Correlation matrices: [row][col] => 0=none, 1=weak, 2=moderate, 3=strong
  corrSW: [[3,0,2],[0,3,0],[0,0,3],[2,1,0]], // annual x breakthrough
  corrNW: [[3,0,0,0],[0,3,0,0],[0,0,3,0],[0,0,0,3],[1,0,1,0]], // priority x annual
  corrNE: [[3,0,0,0,0],[0,3,0,0,0],[0,0,3,0,0],[0,0,0,3,0],[0,0,0,0,3]], // priority x metric
};

function renderXMatrix(){
  mainEl.innerHTML = `
    <div class="grid-2">
      <div class="card">
        <h2>X-Matrix â€” Interactive Builder</h2>
        <p>Click any cell in the correlation matrices to cycle through: none â†’ weak â—‹ â†’ moderate â— â†’ strong â—</p>
        <div class="xmatrix-wrap"><canvas class="xmatrix-canvas" id="xCanvas"></canvas></div>
      </div>
      <div>
        <div class="card">
          <h2>Vision (True North)</h2>
          <input id="xVision" value="${xData.vision}" oninput="xData.vision=this.value;drawXMatrix()">
        </div>
        <div class="card">
          <h2>South â€” Breakthrough Objectives (3-5 yr)</h2>
          <div id="xBreakthroughs"></div>
          <button class="btn-sm" onclick="xData.breakthroughs.push('New objective');renderXMatrix()">+ Add</button>
        </div>
        <div class="card">
          <h2>West â€” Annual Objectives</h2>
          <div id="xAnnuals"></div>
          <button class="btn-sm" onclick="xData.annuals.push('New annual objective');renderXMatrix()">+ Add</button>
        </div>
        <div class="card">
          <h2>North â€” Improvement Priorities</h2>
          <div id="xPriorities"></div>
          <button class="btn-sm" onclick="xData.priorities.push('New priority');renderXMatrix()">+ Add</button>
        </div>
        <div class="card">
          <h2>East â€” Targets / KPIs & Owners</h2>
          <div id="xMetrics"></div>
          <button class="btn-sm" onclick="xData.metrics.push({name:'New KPI',owner:'TBD'});renderXMatrix()">+ Add</button>
        </div>
      </div>
    </div>`;

  // Populate editable lists
  function renderList(arr, elId, key){
    const el = document.getElementById(elId);
    el.innerHTML = arr.map((item,i) => {
      const val = typeof item === 'object' ? item[key||'name'] : item;
      return `<div class="form-row"><input value="${val}" oninput="xUpdateList('${elId}',${i},this.value)">
        <button class="btn-sm btn-danger" onclick="xRemoveItem('${elId}',${i})">Ã—</button></div>`;
    }).join('');
  }
  renderList(xData.breakthroughs, 'xBreakthroughs');
  renderList(xData.annuals, 'xAnnuals');
  renderList(xData.priorities, 'xPriorities');

  const mEl = document.getElementById('xMetrics');
  mEl.innerHTML = xData.metrics.map((m,i) => `
    <div class="form-row">
      <input value="${m.name}" oninput="xData.metrics[${i}].name=this.value;drawXMatrix()" placeholder="KPI">
      <input value="${m.owner}" oninput="xData.metrics[${i}].owner=this.value;drawXMatrix()" placeholder="Owner" style="max-width:120px">
      <button class="btn-sm btn-danger" onclick="xData.metrics.splice(${i},1);renderXMatrix()">Ã—</button>
    </div>`).join('');

  // Draw canvas
  setTimeout(drawXMatrix, 50);
}

window.xUpdateList = function(elId, idx, val){
  const map = {xBreakthroughs:'breakthroughs',xAnnuals:'annuals',xPriorities:'priorities'};
  xData[map[elId]][idx] = val;
  drawXMatrix();
};
window.xRemoveItem = function(elId, idx){
  const map = {xBreakthroughs:'breakthroughs',xAnnuals:'annuals',xPriorities:'priorities'};
  xData[map[elId]].splice(idx, 1);
  renderXMatrix();
};

function drawXMatrix(){
  const canvas = document.getElementById('xCanvas');
  if(!canvas) return;
  const rect = canvas.parentElement.getBoundingClientRect();
  const S = Math.min(rect.width, rect.height);
  canvas.width = S * (window.devicePixelRatio||1);
  canvas.height = S * (window.devicePixelRatio||1);
  canvas.style.width = S+'px';
  canvas.style.height = S+'px';
  const c = canvas.getContext('2d');
  const dpr = window.devicePixelRatio||1;
  c.scale(dpr, dpr);
  const W = S, H = S;
  const cx = W/2, cy = H/2;

  // Background
  c.fillStyle = '#060910';
  c.fillRect(0,0,W,H);

  // X lines
  c.strokeStyle = '#334155';
  c.lineWidth = 1.5;
  c.beginPath(); c.moveTo(0,0); c.lineTo(W,H); c.stroke();
  c.beginPath(); c.moveTo(W,0); c.lineTo(0,H); c.stroke();

  // Center vision box
  const vw = W*0.28, vh = H*0.12;
  c.fillStyle = '#1e293b';
  c.strokeStyle = '#6366f1';
  c.lineWidth = 2;
  roundRect(c, cx-vw/2, cy-vh/2, vw, vh, 8);
  c.fill(); c.stroke();
  c.fillStyle = '#6366f1';
  c.font = `bold ${Math.max(9,W*0.015)}px "Inter", sans-serif`;
  c.textAlign = 'center';
  c.textBaseline = 'middle';
  c.fillText('TRUE NORTH', cx, cy-vh/4);
  c.fillStyle = '#94a3b8';
  c.font = `${Math.max(7,W*0.012)}px sans-serif`;
  wrapText(c, xData.vision, cx, cy+4, vw-16, Math.max(10,W*0.014));

  const fontSize = Math.max(7, W*0.013);
  const labelFont = `${fontSize}px "Inter", sans-serif`;
  const headFont = `bold ${Math.max(8,W*0.015)}px "Inter", sans-serif`;

  // Quadrant labels
  c.font = headFont;
  c.textAlign = 'center';

  c.fillStyle = '#f43f5e'; c.fillText('BREAKTHROUGH OBJECTIVES', cx, H - 14);
  c.fillStyle = '#f59e0b'; c.save(); c.translate(16, cy); c.rotate(-Math.PI/2); c.fillText('ANNUAL OBJECTIVES', 0, 0); c.restore();
  c.fillStyle = '#22d3ee'; c.fillText('IMPROVEMENT PRIORITIES', cx, 18);
  c.fillStyle = '#818cf8'; c.save(); c.translate(W-16, cy); c.rotate(Math.PI/2); c.fillText('TARGETS / KPIs & OWNERS', 0, 0); c.restore();

  // Item labels around edges
  c.font = labelFont;
  c.textBaseline = 'top';

  // South (breakthrough) â€” along bottom, centered
  const bLen = xData.breakthroughs.length;
  c.fillStyle = '#f43f5e';
  c.textAlign = 'center';
  xData.breakthroughs.forEach((b,i) => {
    const x = cx + (i - (bLen-1)/2) * (W*0.22);
    c.fillText(truncate(b,28), x, H - 32 - fontSize);
  });

  // West (annual) â€” along left, vertical-ish
  c.fillStyle = '#f59e0b';
  c.textAlign = 'right';
  c.textBaseline = 'middle';
  const aLen = xData.annuals.length;
  xData.annuals.forEach((a,i) => {
    const y = cy + (i - (aLen-1)/2) * (H*0.1);
    c.fillText(truncate(a,30), W*0.18, y);
  });

  // North (priorities) â€” along top
  c.fillStyle = '#22d3ee';
  c.textAlign = 'center';
  c.textBaseline = 'bottom';
  const pLen = xData.priorities.length;
  xData.priorities.forEach((p,i) => {
    const x = cx + (i - (pLen-1)/2) * (W*0.16);
    c.fillText(truncate(p,22), x, 34 + fontSize);
  });

  // East (metrics) â€” along right
  c.fillStyle = '#818cf8';
  c.textAlign = 'left';
  c.textBaseline = 'middle';
  const mLen = xData.metrics.length;
  xData.metrics.forEach((m,i) => {
    const y = cy + (i - (mLen-1)/2) * (H*0.09);
    c.fillText(truncate(m.name,22), W*0.82, y);
    c.fillStyle = '#94a3b8';
    c.fillText(m.owner, W*0.82, y + fontSize + 2);
    c.fillStyle = '#818cf8';
  });

  // Correlation corners (SW, NW, NE)
  drawCorrelation(c, cx - W*0.28, cy + H*0.18, xData.corrSW, 'SW', W);
  drawCorrelation(c, cx - W*0.28, cy - H*0.18, xData.corrNW, 'NW', W);
  drawCorrelation(c, cx + W*0.14, cy - H*0.18, xData.corrNE, 'NE', W);
}

function drawCorrelation(c, ox, oy, matrix, id, W){
  if(!matrix || !matrix.length) return;
  const cellSize = Math.max(8, W*0.022);
  const rows = matrix.length, cols = matrix[0].length;
  const w = cols*cellSize, h = rows*cellSize;

  c.fillStyle = 'rgba(17,24,39,0.6)';
  c.fillRect(ox, oy, w, h);
  c.strokeStyle = '#334155';
  c.lineWidth = 0.5;

  for(let r=0;r<rows;r++){
    for(let col=0;col<cols;col++){
      const x = ox + col*cellSize + cellSize/2;
      const y = oy + r*cellSize + cellSize/2;
      const v = matrix[r][col];
      c.strokeStyle = '#334155';
      c.strokeRect(ox+col*cellSize, oy+r*cellSize, cellSize, cellSize);
      if(v >= 1){
        const radius = cellSize*0.3;
        c.beginPath(); c.arc(x, y, radius, 0, Math.PI*2);
        if(v === 3){ c.fillStyle='#6366f1'; c.fill(); }
        else if(v === 2){ c.fillStyle='#6366f1'; c.fill(); c.fillStyle='#060910';
          c.beginPath(); c.arc(x,y,radius,Math.PI/2,-Math.PI/2); c.fill(); }
        else { c.strokeStyle='#6366f1'; c.lineWidth=1.5; c.stroke(); }
      }
    }
  }
}

// Click handler for correlation matrices
document.addEventListener('click', (e)=>{
  const canvas = document.getElementById('xCanvas');
  if(!canvas || e.target !== canvas) return;
  // Determine which correlation was clicked â€” simplified: cycle all on click
  // (full implementation would need precise hit-testing)
});

function roundRect(c,x,y,w,h,r){
  c.beginPath(); c.moveTo(x+r,y); c.lineTo(x+w-r,y);
  c.quadraticCurveTo(x+w,y,x+w,y+r); c.lineTo(x+w,y+h-r);
  c.quadraticCurveTo(x+w,y+h,x+w-r,y+h); c.lineTo(x+r,y+h);
  c.quadraticCurveTo(x,y+h,x,y+h-r); c.lineTo(x,y+r);
  c.quadraticCurveTo(x,y,x+r,y); c.closePath();
}

function wrapText(c,text,x,y,maxW,lineH){
  const words=text.split(' ');let line='';
  for(const w of words){
    const test=line+w+' ';
    if(c.measureText(test).width>maxW&&line!==''){
      c.fillText(line.trim(),x,y);y+=lineH;line=w+' ';
    }else{line=test;}
  }
  c.fillText(line.trim(),x,y);
}
function truncate(s,n){return s.length>n?s.slice(0,n-1)+'â€¦':s;}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. PDCA CYCLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let pdcaActive = 0; // 0=Plan,1=Do,2=Check,3=Act
const pdcaStages = [
  {name:'PLAN', color:'#6366f1', desc:'Define goals, develop strategy, create action plans',
   details:['Set breakthrough objectives','Develop annual objectives','Catchball deployment','Create X-Matrix','Identify KPIs and targets'],
   hoshin:'Steps 1-4: Vision â†’ Breakthrough Objectives â†’ Annual Objectives â†’ Catchball Deployment'},
  {name:'DO', color:'#22d3ee', desc:'Execute the plan, implement improvements',
   details:['Execute improvement projects','Run Kaizen events','Implement countermeasures','Collect data on results','Document learnings'],
   hoshin:'Step 5: Teams execute projects and improvement initiatives'},
  {name:'CHECK', color:'#f59e0b', desc:'Review results, compare actual vs. target',
   details:['Monthly Bowling Chart reviews','Track KPIs against targets','RAG status assessment','Identify gaps and trends','Root cause analysis for misses'],
   hoshin:'Step 6: Monthly reviews using Bowling Charts and A3 reports'},
  {name:'ACT', color:'#f43f5e', desc:'Standardize successes, adjust and restart cycle',
   details:['Standardize effective changes','Develop countermeasures for gaps','Annual review (Hansei)','Update X-Matrix for next cycle','Feed learnings into next Plan phase'],
   hoshin:'Step 7: Annual review â€” reflect, learn, adjust, restart cycle'},
];

function renderPDCA(){
  mainEl.innerHTML = `
    <div class="grid-2">
      <div class="card">
        <h2>PDCA Cycle (Deming Wheel)</h2>
        <p style="margin-bottom:10px">Click each quadrant to explore how it maps to Hoshin Kanri.</p>
        <div class="pdca-wrap"><canvas id="pdcaCanvas" class="pdca-canvas" width="500" height="500"></canvas></div>
      </div>
      <div>
        <div class="card" id="pdcaDetail"></div>
        <div class="card">
          <h2>PDCA in Hoshin Kanri</h2>
          <p>The entire Hoshin Kanri annual cycle is one large PDCA loop. Monthly reviews create smaller nested PDCA loops within it. Every unmet target triggers a new mini-PDCA: analyze the gap, develop a countermeasure, implement, and check again.</p>
          <ul style="margin-top:8px">
            <li>Annual cycle = Macro PDCA</li>
            <li>Monthly reviews = Micro PDCA</li>
            <li>Countermeasures = Nano PDCA</li>
          </ul>
        </div>
        <div class="card">
          <h2>Origin</h2>
          <p>Created by <b>Walter Shewhart</b> (1920s, Bell Labs). Popularized globally by <b>W. Edwards Deming</b> in Japan (1950s). Also known as Deming Cycle, Deming Wheel, or Shewhart Cycle.</p>
        </div>
      </div>
    </div>`;
  drawPDCA();
  updatePDCADetail();

  document.getElementById('pdcaCanvas').addEventListener('click', (e) => {
    const rect = e.target.getBoundingClientRect();
    const x = e.offsetX - 250, y = e.offsetY - 250;
    if(x >= 0 && y < 0) pdcaActive = 1;      // top-right = Do
    else if(x < 0 && y < 0) pdcaActive = 0;   // top-left = Plan
    else if(x < 0 && y >= 0) pdcaActive = 3;   // bottom-left = Act
    else pdcaActive = 2;                        // bottom-right = Check
    drawPDCA();
    updatePDCADetail();
  });
}

function drawPDCA(){
  const canvas = document.getElementById('pdcaCanvas');
  if(!canvas) return;
  const c = canvas.getContext('2d');
  const W = 500, cx = 250, cy = 250, R = 200;
  c.clearRect(0,0,W,W);

  // Draw 4 quadrants
  pdcaStages.forEach((stage, i) => {
    const startAngle = -Math.PI + (i * Math.PI/2);
    const endAngle = startAngle + Math.PI/2;
    const isActive = i === pdcaActive;

    c.beginPath();
    c.moveTo(cx, cy);
    c.arc(cx, cy, R + (isActive?10:0), startAngle, endAngle);
    c.closePath();
    c.fillStyle = isActive ? stage.color : stage.color + '44';
    c.fill();
    c.strokeStyle = stage.color;
    c.lineWidth = isActive ? 3 : 1.5;
    c.stroke();

    // Label
    const midAngle = startAngle + Math.PI/4;
    const lx = cx + Math.cos(midAngle) * R * 0.55;
    const ly = cy + Math.sin(midAngle) * R * 0.55;
    c.fillStyle = isActive ? '#fff' : stage.color;
    c.font = `bold ${isActive?22:18}px "Inter", sans-serif`;
    c.textAlign = 'center';
    c.textBaseline = 'middle';
    c.fillText(stage.name, lx, ly);
  });

  // Center circle
  c.beginPath(); c.arc(cx,cy,40,0,Math.PI*2);
  c.fillStyle = '#060910'; c.fill();
  c.strokeStyle = '#6366f1'; c.lineWidth = 2; c.stroke();
  c.fillStyle = '#6366f1';
  c.font = 'bold 14px sans-serif';
  c.fillText('PDCA', cx, cy);

  // Rotation arrow
  c.strokeStyle = '#94a3b8';
  c.lineWidth = 2;
  c.beginPath();
  c.arc(cx, cy, R + 25, -Math.PI*0.8, Math.PI*0.6);
  c.stroke();
  // Arrowhead
  const aAngle = Math.PI*0.6;
  const ax = cx + Math.cos(aAngle)*(R+25), ay = cy + Math.sin(aAngle)*(R+25);
  c.fillStyle = '#94a3b8';
  c.beginPath();
  c.moveTo(ax, ay);
  c.lineTo(ax + 10*Math.cos(aAngle-0.8), ay + 10*Math.sin(aAngle-0.8));
  c.lineTo(ax + 10*Math.cos(aAngle+0.5), ay + 10*Math.sin(aAngle+0.5));
  c.closePath(); c.fill();
}

function updatePDCADetail(){
  const s = pdcaStages[pdcaActive];
  const el = document.getElementById('pdcaDetail');
  if(!el) return;
  el.innerHTML = `
    <h2 style="color:${s.color}">${s.name}</h2>
    <h3>${s.desc}</h3>
    <ul>${s.details.map(d=>`<li>${d}</li>`).join('')}</ul>
    <p style="margin-top:10px;padding:8px;background:rgba(99,102,241,.08);border-radius:6px;border-left:3px solid ${s.color}">
      <b>Hoshin Kanri mapping:</b> ${s.hoshin}</p>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. BOWLING CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
let bowlingKPIs = [
  {name:'Revenue Growth', unit:'%', baseline:5, direction:'up',
   targets:[5.5,6.0,6.5,7.0,7.5,8.0,8.5,9.0,9.5,10,10,10],
   actuals:[5.3,6.2,6.1,7.2,null,null,null,null,null,null,null,null],
   owner:'CFO', threshold:0.5},
  {name:'Defect Rate', unit:'ppm', baseline:500, direction:'down',
   targets:[480,460,440,420,400,380,360,340,320,300,300,300],
   actuals:[475,450,455,410,null,null,null,null,null,null,null,null],
   owner:'VP Quality', threshold:20},
  {name:'Employee Certification', unit:'count', baseline:50, direction:'up',
   targets:[80,120,170,230,280,330,380,420,460,490,500,500],
   actuals:[85,130,160,null,null,null,null,null,null,null,null,null],
   owner:'HR Dir', threshold:15},
];

function renderBowling(){
  mainEl.innerHTML = `
    <div class="card">
      <h2>Bowling Chart â€” Monthly KPI Tracker</h2>
      <p style="margin-bottom:10px">Click any <b>Actual</b> cell to enter a value. Colors:
        <span style="color:var(--accent2)">â–  Green</span> = on target,
        <span style="color:var(--warn)">â–  Yellow</span> = warning,
        <span style="color:var(--danger)">â–  Red</span> = off track</p>
      <div style="overflow-x:auto">
        <table class="bowling-table" id="bowlingTable"></table>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button onclick="addBowlingKPI()">+ Add KPI</button>
        <button onclick="bowlingKPIs.forEach(k=>{for(let i=0;i<12;i++)k.actuals[i]=null});renderBowling()">Clear Actuals</button>
      </div>
    </div>
    <div class="card">
      <h2>How to Read a Bowling Chart</h2>
      <div class="grid-3">
        <div><h3 style="color:var(--accent2)">Green</h3><p>Actual meets or exceeds target. Continue current approach.</p></div>
        <div><h3 style="color:var(--warn)">Yellow</h3><p>Within threshold of target. Investigate trend and prepare countermeasures.</p></div>
        <div><h3 style="color:var(--danger)">Red</h3><p>Below threshold. Immediate countermeasures required â€” link to A3 report.</p></div>
      </div>
    </div>`;
  buildBowlingTable();
}

function buildBowlingTable(){
  const t = document.getElementById('bowlingTable');
  let html = `<thead><tr><th>KPI</th><th>Unit</th><th>â†•</th><th>Base</th><th>Owner</th><th>Row</th>`;
  MONTHS.forEach(m => html += `<th>${m}</th>`);
  html += `</tr></thead><tbody>`;

  bowlingKPIs.forEach((kpi, ki) => {
    // Target row
    html += `<tr><td class="kpi-name" rowspan="2">${kpi.name}</td>
      <td rowspan="2">${kpi.unit}</td>
      <td rowspan="2">${kpi.direction==='up'?'â†‘':'â†“'}</td>
      <td rowspan="2">${kpi.baseline}</td>
      <td rowspan="2" style="font-size:.65rem">${kpi.owner}</td>
      <td class="target">Target</td>`;
    kpi.targets.forEach(v => html += `<td class="target">${v??''}</td>`);
    html += `</tr>`;

    // Actual row
    html += `<tr><td style="font-weight:600">Actual</td>`;
    kpi.actuals.forEach((v, mi) => {
      let cls = '';
      if(v !== null && v !== undefined){
        const tgt = kpi.targets[mi];
        if(kpi.direction === 'up'){
          if(v >= tgt) cls = 'green';
          else if(v >= tgt - kpi.threshold) cls = 'yellow';
          else cls = 'red';
        } else {
          if(v <= tgt) cls = 'green';
          else if(v <= tgt + kpi.threshold) cls = 'yellow';
          else cls = 'red';
        }
      }
      html += `<td class="${cls}" style="cursor:pointer" onclick="editBowlingCell(${ki},${mi},this)">${v??''}</td>`;
    });
    html += `</tr>`;
  });

  html += `</tbody>`;
  t.innerHTML = html;
}

window.editBowlingCell = function(ki, mi, td){
  const current = bowlingKPIs[ki].actuals[mi];
  const val = prompt(`Enter actual for ${bowlingKPIs[ki].name} â€” ${MONTHS[mi]}:`, current??'');
  if(val === null) return;
  bowlingKPIs[ki].actuals[mi] = val === '' ? null : parseFloat(val);
  buildBowlingTable();
};

window.addBowlingKPI = function(){
  const name = prompt('KPI name:', 'New KPI');
  if(!name) return;
  bowlingKPIs.push({
    name, unit:'', baseline:0, direction:'up', owner:'TBD', threshold:5,
    targets: new Array(12).fill(0),
    actuals: new Array(12).fill(null),
  });
  renderBowling();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. A3 REPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const a3Data = {
  title: 'Reduce Assembly Line Defect Rate',
  background: 'Current defect rate is 500 ppm, target is 300 ppm by year-end. Defects are concentrated in Station 7 (soldering) and Station 12 (final assembly). This impacts customer satisfaction scores and warranty costs.',
  current: 'Station 7: 45% of defects (cold solder joints)\nStation 12: 30% of defects (misaligned housings)\nRemaining 25% distributed across other stations\nNo standardized inspection protocol at these stations.',
  analysis: 'Why cold solder joints? â†’ Inconsistent temperature settings\nWhy inconsistent? â†’ No standard work procedure\nWhy no standard? â†’ Recent equipment upgrade, procedures not updated\nWhy not updated? â†’ No change management process for equipment changes',
  target: '1. Create standard work for new soldering equipment\n2. Install visual temperature indicators at Station 7\n3. Add alignment jig fixture at Station 12\n4. Implement change management checklist for equipment updates',
  plan: 'Week 1-2: Document current process, develop standard work\nWeek 3: Install visual indicators and alignment jigs\nWeek 4: Train operators, pilot for one shift\nWeek 5-6: Full deployment, monitor daily',
  followup: 'Daily defect tracking for 30 days post-implementation\nWeekly review with team leads\nMonthly report to Bowling Chart\nTarget: <350 ppm within 60 days',
};

function renderA3(){
  mainEl.innerHTML = `
    <div class="card">
      <h2>A3 Report â€” Problem-Solving Template</h2>
      <p style="margin-bottom:12px">The A3 is Toyota's structured approach to problem-solving. Left side = understanding (Plan). Right side = action (Do/Check/Act). Edit any section below.</p>
    </div>
    <div class="a3-grid">
      <div class="a3-section full-width">
        <h3>1. Title / Theme</h3>
        <input value="${a3Data.title}" oninput="a3Data.title=this.value" style="font-size:.9rem;font-weight:600">
      </div>
      <div class="a3-section">
        <h3>2. Background</h3>
        <p style="font-size:.65rem;margin-bottom:4px">Context, relevance, connection to goals</p>
        <textarea rows="4" oninput="a3Data.background=this.value">${a3Data.background}</textarea>
      </div>
      <div class="a3-section">
        <h3>5. Target Condition / Countermeasures</h3>
        <p style="font-size:.65rem;margin-bottom:4px">Future state & specific countermeasures</p>
        <textarea rows="4" oninput="a3Data.target=this.value">${a3Data.target}</textarea>
      </div>
      <div class="a3-section">
        <h3>3. Current Condition</h3>
        <p style="font-size:.65rem;margin-bottom:4px">Visual description of existing process & problems</p>
        <textarea rows="4" oninput="a3Data.current=this.value">${a3Data.current}</textarea>
      </div>
      <div class="a3-section">
        <h3>6. Implementation Plan</h3>
        <p style="font-size:.65rem;margin-bottom:4px">Tasks, owners, deadlines, expected outcomes</p>
        <textarea rows="4" oninput="a3Data.plan=this.value">${a3Data.plan}</textarea>
      </div>
      <div class="a3-section">
        <h3>4. Root Cause Analysis (5 Whys)</h3>
        <p style="font-size:.65rem;margin-bottom:4px">Drill into causal chain</p>
        <textarea rows="4" oninput="a3Data.analysis=this.value">${a3Data.analysis}</textarea>
      </div>
      <div class="a3-section">
        <h3>7. Follow-Up & Results</h3>
        <p style="font-size:.65rem;margin-bottom:4px">Measurement plan, actual results</p>
        <textarea rows="4" oninput="a3Data.followup=this.value">${a3Data.followup}</textarea>
      </div>
    </div>
    <div class="card" style="margin-top:14px">
      <h2>A3 Structure â€” PDCA Mapping</h2>
      <div class="grid-2">
        <div><h3 style="color:var(--accent)">Left Side â†’ PLAN</h3>
          <p>Sections 2-4 capture what you've <b>observed</b>: background, current state, root cause analysis. This is the deep thinking before action.</p></div>
        <div><h3 style="color:var(--accent2)">Right Side â†’ DO / CHECK / ACT</h3>
          <p>Sections 5-7 capture what you want to <b>try</b>: countermeasures, implementation, and follow-up with measured results.</p></div>
      </div>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 5. KAIZEN BOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let kaizenItems = [
  {id:1,title:'Reduce changeover time at Press A',type:'Point',owner:'T. Nakamura',col:'ideas'},
  {id:2,title:'Standardize packaging labels',type:'Point',owner:'S. Kim',col:'planned'},
  {id:3,title:'5S event â€” Warehouse Zone C',type:'Line',owner:'J. Garcia',col:'doing'},
  {id:4,title:'Value stream map: Order-to-Ship',type:'System',owner:'M. Chen',col:'done'},
  {id:5,title:'Reduce WIP between Stations 3-5',type:'Line',owner:'R. Patel',col:'ideas'},
  {id:6,title:'Cross-train assembly & QC teams',type:'Plane',owner:'L. Brown',col:'planned'},
];
let nextKaizenId = 7;

function renderKaizen(){
  mainEl.innerHTML = `
    <div class="card">
      <h2>Kaizen Improvement Board</h2>
      <p>Drag cards between columns or use the buttons to move them. Click + to add new improvement ideas.</p>
      <div style="margin-top:8px;display:flex;gap:6px;flex-wrap:wrap">
        <button onclick="addKaizenItem()">+ New Idea</button>
        <span style="font-size:.7rem;color:var(--muted);line-height:2.2">
          Types: <b>Point</b> (single task) Â· <b>Line</b> (value stream) Â· <b>Plane</b> (cross-dept) Â· <b>System</b> (organizational) Â· <b>Cube</b> (enterprise-wide)</span>
      </div>
    </div>
    <div class="kaizen-cols" id="kaizenBoard">
      <div class="kaizen-col"><h3 class="ideas">ğŸ’¡ Ideas</h3><div class="col-items" data-col="ideas"></div></div>
      <div class="kaizen-col"><h3 class="planned">ğŸ“‹ Planned</h3><div class="col-items" data-col="planned"></div></div>
      <div class="kaizen-col"><h3 class="doing">ğŸ”§ In Progress</h3><div class="col-items" data-col="doing"></div></div>
      <div class="kaizen-col"><h3 class="done">âœ… Done</h3><div class="col-items" data-col="done"></div></div>
    </div>
    <div class="card" style="margin-top:14px">
      <h2>Kaizen Principles</h2>
      <div class="grid-3">
        <div><h3>10 Core Principles</h3>
          <ol style="padding-left:16px;font-size:.74rem;color:var(--muted)">
            <li>Improve everything continuously</li><li>Abolish the status quo</li>
            <li>Small improvements > perfection</li><li>Seek root causes (5 Whys)</li>
            <li>Embrace change</li><li>Learn by doing</li><li>Fix problems immediately</li>
            <li>Use data over opinions</li><li>Think creatively</li><li>No limits to improvement</li>
          </ol></div>
        <div><h3>Kaizen Events (Blitz)</h3>
          <p>Focused 3-5 day cross-functional improvement sprints. Select a specific problem, assemble a team, analyze, implement, and verify â€” all within one week.</p></div>
        <div><h3>Gemba Walks</h3>
          <p><b>Gemba</b> = "the actual place." Go and see â†’ Observe â†’ Ask why. Look for TIMWOODS waste: Transport, Inventory, Motion, Waiting, Overproduction, Overprocessing, Defects, Skills underused.</p></div>
      </div>
    </div>`;
  populateKaizenBoard();
}

function populateKaizenBoard(){
  const cols = {ideas:[], planned:[], doing:[], done:[]};
  kaizenItems.forEach(item => {if(cols[item.col]) cols[item.col].push(item);});

  Object.keys(cols).forEach(colName => {
    const container = document.querySelector(`.col-items[data-col="${colName}"]`);
    if(!container) return;
    container.innerHTML = cols[colName].map(item => `
      <div class="kaizen-card" draggable="true" data-id="${item.id}" ondragstart="kDragStart(event,${item.id})">
        <div class="title">${item.title}</div>
        <div class="meta">${item.type} Kaizen Â· ${item.owner}</div>
        <div style="margin-top:4px;display:flex;gap:3px">
          ${colName!=='ideas'?`<button class="btn-sm" onclick="moveKaizen(${item.id},'back')">â—€</button>`:''}
          ${colName!=='done'?`<button class="btn-sm" onclick="moveKaizen(${item.id},'fwd')">â–¶</button>`:''}
          <button class="btn-sm btn-danger" onclick="removeKaizen(${item.id})">Ã—</button>
        </div>
      </div>`).join('');

    container.ondragover = e => e.preventDefault();
    container.ondrop = e => {
      e.preventDefault();
      const id = parseInt(e.dataTransfer.getData('text'));
      const item = kaizenItems.find(k=>k.id===id);
      if(item) item.col = colName;
      populateKaizenBoard();
    };
  });
}

window.kDragStart = (e, id) => e.dataTransfer.setData('text', id);
window.moveKaizen = (id, dir) => {
  const order = ['ideas','planned','doing','done'];
  const item = kaizenItems.find(k=>k.id===id);
  const idx = order.indexOf(item.col);
  if(dir==='fwd' && idx<3) item.col = order[idx+1];
  if(dir==='back' && idx>0) item.col = order[idx-1];
  populateKaizenBoard();
};
window.removeKaizen = (id) => {
  kaizenItems = kaizenItems.filter(k=>k.id!==id);
  populateKaizenBoard();
};
window.addKaizenItem = () => {
  const title = prompt('Improvement idea:');
  if(!title) return;
  const type = prompt('Type (Point/Line/Plane/System/Cube):', 'Point') || 'Point';
  const owner = prompt('Owner:', 'TBD') || 'TBD';
  kaizenItems.push({id:nextKaizenId++, title, type, owner, col:'ideas'});
  populateKaizenBoard();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 6. CATCHBALL VISUALIZER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let catchballStep = 0;
const catchballLevels = [
  {role:'Executive Leadership', desc:'Sets True North and 3-5 breakthrough objectives', color:'#f43f5e'},
  {role:'Senior Managers', desc:'Provide feedback, identify obstacles, propose tactics', color:'#f59e0b'},
  {role:'Department Heads', desc:'Break into departmental objectives, validate feasibility', color:'#6366f1'},
  {role:'Team Leaders', desc:'Define team-level goals and action plans', color:'#818cf8'},
  {role:'Individual Contributors', desc:'Understand personal contribution to strategy', color:'#22d3ee'},
];

function renderCatchball(){
  mainEl.innerHTML = `
    <div class="grid-2">
      <div class="card">
        <h2>Catchball Process â€” Goal Cascade Visualizer</h2>
        <p style="margin-bottom:10px">Watch how goals cascade down and refine back up. Click Play or step through manually.</p>
        <canvas id="catchballCanvas" class="catchball-canvas" width="750" height="520"></canvas>
        <div style="margin-top:10px;display:flex;gap:6px;align-items:center">
          <button onclick="catchballStep=Math.max(0,catchballStep-1);drawCatchball()">â—€ Back</button>
          <button id="cbPlay" onclick="playCatchball()">â–¶ Play</button>
          <button onclick="catchballStep=Math.min(8,catchballStep+1);drawCatchball()">Forward â–¶</button>
          <span style="font-size:.7rem;color:var(--muted);margin-left:8px">Step ${catchballStep + 1} / 9</span>
        </div>
      </div>
      <div>
        <div class="card">
          <h2>How Catchball Works</h2>
          <ul>
            <li><b>Throw:</b> Leadership defines strategic direction and shares it downward</li>
            <li><b>Catch:</b> Each layer receives, evaluates, and refines based on operational knowledge</li>
            <li><b>Return:</b> Feedback flows back up â€” modifications based on real-world feasibility</li>
            <li><b>Consensus:</b> After multiple rounds, the plan has genuine buy-in at every level</li>
          </ul>
        </div>
        <div class="card">
          <h2>Key Outcomes</h2>
          <ul>
            <li><b>Alignment</b> â€” everyone understands how their work connects to strategy</li>
            <li><b>Buy-in</b> â€” not just compliance but genuine ownership</li>
            <li><b>Feasibility</b> â€” each level validates that targets are achievable</li>
            <li><b>Waste reduction</b> â€” prevents misaligned effort from poor communication</li>
          </ul>
        </div>
        <div class="card">
          <h2>vs. Top-Down (MBO)</h2>
          <p>In traditional MBO, goals are dictated from the top with no mechanism for feedback. This leads to unrealistic targets, lack of ownership, and departments working at cross-purposes. Catchball replaces fear with trust and edicts with consensus.</p>
        </div>
      </div>
    </div>`;
  drawCatchball();
}

let cbPlaying = false;
window.playCatchball = () => {
  cbPlaying = !cbPlaying;
  document.getElementById('cbPlay').textContent = cbPlaying ? 'â¸ Pause' : 'â–¶ Play';
  if(cbPlaying) cbAutoStep();
};
function cbAutoStep(){
  if(!cbPlaying) return;
  catchballStep = (catchballStep + 1) % 9;
  drawCatchball();
  setTimeout(cbAutoStep, 1200);
}

function drawCatchball(){
  const canvas = document.getElementById('catchballCanvas');
  if(!canvas) return;
  const c = canvas.getContext('2d');
  const W = 750, H = 520;
  c.clearRect(0,0,W,H);

  const levels = catchballLevels;
  const rowH = H / levels.length;
  const boxW = 260, boxH = 50;

  // Draw levels
  levels.forEach((lv, i) => {
    const y = i * rowH + rowH/2;
    const x = W/2 - boxW/2;

    // Background band
    c.fillStyle = lv.color + '08';
    c.fillRect(0, i*rowH, W, rowH);

    // Box
    c.fillStyle = lv.color + '22';
    c.strokeStyle = lv.color;
    c.lineWidth = catchballStep >= i*2 ? 2.5 : 1;
    roundRect(c, x, y - boxH/2, boxW, boxH, 8);
    c.fill(); c.stroke();

    // Text
    c.fillStyle = lv.color;
    c.font = 'bold 13px "Inter", sans-serif';
    c.textAlign = 'center';
    c.textBaseline = 'middle';
    c.fillText(lv.role, W/2, y - 8);
    c.fillStyle = '#94a3b8';
    c.font = '10px sans-serif';
    c.fillText(lv.desc, W/2, y + 10);
  });

  // Draw throw/catch arrows based on step
  // Steps: 0=exec sets, 1=throw to senior, 2=senior catches, 3=throw to dept, etc.
  const arrowPairs = [
    {from:0, to:1, label:'Throw: breakthrough objectives'},
    {from:1, to:0, label:'Catch: feedback & tactics'},
    {from:1, to:2, label:'Throw: refined annual objectives'},
    {from:2, to:1, label:'Catch: feasibility & obstacles'},
    {from:2, to:3, label:'Throw: departmental goals'},
    {from:3, to:2, label:'Catch: team-level adjustments'},
    {from:3, to:4, label:'Throw: individual contributions'},
    {from:4, to:3, label:'Catch: ground-level insights'},
  ];

  for(let s = 0; s <= Math.min(catchballStep, arrowPairs.length-1); s++){
    const ap = arrowPairs[s];
    const fromY = ap.from * rowH + rowH/2;
    const toY = ap.to * rowH + rowH/2;
    const isDown = ap.to > ap.from;
    const xOff = isDown ? 50 : -50;
    const arrowX = W/2 + xOff + (isDown ? 140 : -140);

    const alpha = s === catchballStep ? 1 : 0.3;
    const lv = levels[ap.from];

    // Arrow line
    c.strokeStyle = lv.color + (s===catchballStep?'ff':'55');
    c.lineWidth = s===catchballStep ? 3 : 1.5;
    c.setLineDash(isDown ? [] : [6,4]);
    c.beginPath();
    c.moveTo(arrowX, fromY + (isDown ? boxH/2+4 : -boxH/2-4));
    c.lineTo(arrowX, toY + (isDown ? -boxH/2-8 : boxH/2+8));
    c.stroke();
    c.setLineDash([]);

    // Arrowhead
    const tipY = toY + (isDown ? -boxH/2-8 : boxH/2+8);
    const dir = isDown ? 1 : -1;
    c.fillStyle = lv.color + (s===catchballStep?'ff':'55');
    c.beginPath();
    c.moveTo(arrowX, tipY);
    c.lineTo(arrowX-6, tipY-dir*10);
    c.lineTo(arrowX+6, tipY-dir*10);
    c.closePath(); c.fill();

    // Label
    if(s === catchballStep){
      c.fillStyle = lv.color;
      c.font = 'bold 10px sans-serif';
      c.textAlign = isDown ? 'left' : 'right';
      c.fillText(ap.label, arrowX + (isDown ? 8 : -8), (fromY+toY)/2);

      // Ball emoji
      c.font = '20px sans-serif';
      c.textAlign = 'center';
      const ballY = fromY + (toY-fromY) * 0.5;
      c.fillText('ğŸ”µ', arrowX, ballY);
    }
  }

  // Update step counter
  const stepSpan = document.querySelector('.controls span, [style*="margin-left:8px"]');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 7. KNOWLEDGE BASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderKnowledge(){
  const cards = [
    {title:'Hoshin Kanri', tag:'Strategy', desc:'Japanese strategic planning methodology aligning organizational goals top-to-bottom. "Compass management" â€” focuses on 3-5 breakthrough objectives deployed via Catchball and tracked with PDCA.'},
    {title:'X-Matrix', tag:'Tool', desc:'Single-page strategic alignment document. Four quadrants: Breakthrough Objectives (South), Annual Objectives (West), Improvement Priorities (North), Targets & Owners (East). Correlation diamonds show relationships.'},
    {title:'True North', tag:'Concept', desc:'The organization\'s long-term aspirational vision. Not a specific target but a directional guide that all strategy aligns toward. Like a compass needle pointing to the ideal future state.'},
    {title:'Catchball', tag:'Process', desc:'Bidirectional communication process. Goals are "thrown" down through management layers; each layer catches, refines, validates feasibility, and throws back. Creates genuine consensus and buy-in.'},
    {title:'PDCA Cycle', tag:'Framework', desc:'Plan-Do-Check-Act. Created by Shewhart (1920s), popularized by Deming. The engine that drives Hoshin Kanri â€” one macro PDCA per year with micro PDCAs monthly.'},
    {title:'Kaizen', tag:'Philosophy', desc:'"Change for the better." Continuous improvement through small, incremental changes involving everyone. 10 principles, 5 types (Point, Line, Plane, Cube, System), Kaizen Events/Blitz.'},
    {title:'A3 Thinking', tag:'Tool', desc:'Toyota\'s structured problem-solving approach on a single A3 page. Left side = understanding (Plan), Right side = action (Do/Check/Act). 7 sections from Title to Follow-Up.'},
    {title:'Bowling Chart', tag:'Tool', desc:'Monthly KPI tracking tool. Each metric has Target and Actual rows across 12 months. RAG color coding (Green/Yellow/Red) for instant visibility. Key to Step 6 monthly reviews.'},
    {title:'Breakthrough Objectives', tag:'Concept', desc:'3-5 transformative goals on a 3-5 year horizon requiring significant change, innovation, or capability building. The "vital few" that concentrate organizational focus.'},
    {title:'Gemba Walk', tag:'Practice', desc:'"Go to the actual place." Leaders visit where work happens, observe processes, and ask "why?" Look for TIMWOODS waste. Build understanding through direct observation, not reports.'},
    {title:'5 Whys', tag:'Technique', desc:'Root cause analysis by asking "why?" five times. Each answer forms the basis of the next question. Peels back symptoms to reveal systemic root causes. Core to A3 analysis.'},
    {title:'Countermeasures', tag:'Concept', desc:'The response to unmet targets in Hoshin Kanri. NOT punishment â€” but problem-solving actions. Reflects a culture of trust and learning. Every red Bowling Chart cell should link to countermeasures.'},
    {title:'Nemawashi', tag:'Concept', desc:'Building consensus through informal discussions before formal decisions. Laying the groundwork so that by the time a proposal is presented formally, key stakeholders already support it.'},
    {title:'Hansei', tag:'Concept', desc:'Self-reflection â€” honest acknowledgment of weaknesses and commitment to improvement. Central to annual reviews (Step 7). Asks "What did we learn?" not "Who failed?"'},
    {title:'Hoshin vs. MBO', tag:'Comparison', desc:'MBO is top-down, results-only, punitive. Hoshin Kanri is bidirectional (Catchball), focuses on process AND results, treats unmet targets as learning opportunities, and ensures cross-functional alignment.'},
    {title:'TIMWOODS', tag:'Framework', desc:'8 types of waste in Lean: Transport, Inventory, Motion, Waiting, Overproduction, Overprocessing, Defects, Skills underused. Identified during Gemba walks and Kaizen events.'},
    {title:'Standard Work', tag:'Practice', desc:'The current best-known way to perform a task. Not rigid â€” it\'s the baseline from which Kaizen improvements are made. Without standard work, there is no basis for improvement.'},
    {title:'Value Stream Mapping', tag:'Tool', desc:'Visual tool for analyzing the flow of materials and information from supplier to customer. Identifies waste, bottlenecks, and improvement opportunities. Used in System Kaizen.'},
  ];

  mainEl.innerHTML = `
    <div class="card">
      <h2>Knowledge Base â€” Quick Reference</h2>
      <p>Explore key concepts, tools, and practices in Hoshin Kanri and Lean strategy deployment.</p>
      <div style="margin-top:8px">
        <input id="kbSearch" placeholder="Search concepts..." oninput="filterKB(this.value)">
      </div>
    </div>
    <div class="kb-grid" id="kbGrid">
      ${cards.map(card => `
        <div class="kb-card" data-search="${(card.title+' '+card.desc+' '+card.tag).toLowerCase()}">
          <h3>${card.title}</h3>
          <p>${card.desc}</p>
          <span class="tag">${card.tag}</span>
        </div>`).join('')}
    </div>`;
}

window.filterKB = (query) => {
  const q = query.toLowerCase();
  document.querySelectorAll('.kb-card').forEach(card => {
    card.style.display = card.dataset.search.includes(q) ? '' : 'none';
  });
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderPage(activePage);
window.addEventListener('resize', () => {
  if(activePage === 'xmatrix') drawXMatrix();
});
</script>
</body>
</html>
