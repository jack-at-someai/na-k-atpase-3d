<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Charlotte Research Lab — Knowledge Graph</title>
<style>
  :root {
    --bg: #060a13; --surface: #0d1117; --border: #1e2a3a;
    --text: #c9d1d9; --text-dim: #6e7681; --text-bright: #f0f6fc;
    --blue: #58a6ff; --green: #3fb950; --gold: #d29922; --red: #f85149;
    --purple: #bc8cff; --cyan: #39d2c0; --pink: #f778ba; --orange: #f0883e;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: -apple-system, 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; }
  svg { width: 100%; height: 100vh; display: block; }

  .header {
    position: fixed; top: 0; left: 0; right: 0; z-index: 10;
    background: linear-gradient(180deg, rgba(6,10,19,0.95) 0%, rgba(6,10,19,0.7) 70%, transparent 100%);
    padding: 16px 24px 32px; pointer-events: none;
  }
  .header > * { pointer-events: auto; }
  .header h1 { font-size: 20px; font-weight: 700; color: var(--text-bright); letter-spacing: -0.3px; }
  .header .sub { font-size: 12px; color: var(--text-dim); margin-top: 2px; }

  .search-bar {
    position: fixed; top: 16px; right: 24px; z-index: 20;
  }
  .search-bar input {
    background: var(--surface); border: 1px solid var(--border); color: var(--text);
    padding: 8px 14px; border-radius: 8px; font-size: 13px; width: 240px; outline: none;
  }
  .search-bar input:focus { border-color: var(--blue); }

  .legend {
    position: fixed; bottom: 16px; left: 24px; z-index: 10;
    background: rgba(13,17,23,0.92); border: 1px solid var(--border);
    border-radius: 10px; padding: 14px 18px; backdrop-filter: blur(12px);
  }
  .legend h3 { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
  .legend-item { display: flex; align-items: center; gap: 8px; margin: 4px 0; font-size: 12px; cursor: pointer; }
  .legend-item:hover { color: var(--text-bright); }
  .legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }

  .filters {
    position: fixed; top: 60px; left: 24px; z-index: 10;
    display: flex; flex-wrap: wrap; gap: 6px; max-width: 520px;
  }
  .filter-btn {
    background: var(--surface); border: 1px solid var(--border); color: var(--text-dim);
    padding: 4px 10px; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.15s;
  }
  .filter-btn:hover { border-color: var(--blue); color: var(--text); }
  .filter-btn.active { background: rgba(88,166,255,0.15); border-color: var(--blue); color: var(--blue); }

  .detail {
    position: fixed; bottom: 16px; right: 24px; z-index: 10;
    background: rgba(13,17,23,0.95); border: 1px solid var(--border);
    border-radius: 12px; padding: 18px 22px; width: 360px;
    backdrop-filter: blur(12px); display: none; max-height: 70vh; overflow-y: auto;
  }
  .detail.open { display: block; }
  .detail-close {
    position: absolute; top: 10px; right: 14px; background: none;
    border: none; color: var(--text-dim); font-size: 18px; cursor: pointer;
  }
  .detail h2 { font-size: 16px; color: var(--text-bright); margin-bottom: 4px; max-width: 300px; }
  .type-badge {
    display: inline-block; font-size: 10px; padding: 2px 8px; border-radius: 4px;
    text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px;
  }
  .detail .desc { font-size: 12px; color: var(--text); line-height: 1.5; margin-bottom: 10px; }
  .detail .connections { font-size: 11px; color: var(--text-dim); }
  .conn-list { margin-top: 4px; max-height: 300px; overflow-y: auto; }
  .conn-item {
    display: flex; align-items: center; gap: 6px; padding: 3px 0;
    font-size: 11px; color: var(--text); cursor: pointer;
  }
  .conn-item:hover { color: var(--blue); }
  .conn-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }

  .stats {
    position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); z-index: 10;
    display: flex; gap: 24px;
    background: rgba(13,17,23,0.9); border: 1px solid var(--border);
    border-radius: 8px; padding: 8px 20px; font-size: 11px; color: var(--text-dim);
  }
  .stats span strong { color: var(--text); }

  .tooltip {
    position: fixed; z-index: 30; pointer-events: none;
    background: rgba(13,17,23,0.95); border: 1px solid var(--border);
    border-radius: 6px; padding: 6px 10px; font-size: 11px;
    color: var(--text-bright); max-width: 280px; display: none;
  }

  .back-link {
    position: fixed; top: 16px; left: 24px; z-index: 20;
    color: var(--text-dim); text-decoration: none; font-size: 13px;
  }
  .back-link:hover { color: var(--blue); }

  @media (max-width: 768px) {
    .detail { width: calc(100vw - 32px); right: 16px; bottom: 60px; }
    .legend { bottom: 60px; left: 16px; }
    .filters { top: 55px; left: 16px; max-width: 90vw; }
  }
</style>
</head>
<body>

<a class="back-link" href="../">&larr; Portfolio</a>

<div class="header" style="left:80px">
  <h1>Charlotte Research Lab</h1>
  <div class="sub">The entire project as a knowledge graph &mdash; <span id="node-count">0</span> nodes, <span id="edge-count">0</span> edges</div>
</div>

<div class="search-bar">
  <input type="text" id="search" placeholder="Search nodes...">
</div>

<div class="filters" id="filters"></div>

<svg id="graph"></svg>

<div class="legend" id="legend"></div>

<div class="detail" id="detail">
  <button class="detail-close" onclick="closeDetail()">&times;</button>
  <h2 id="detail-name"></h2>
  <span class="type-badge" id="detail-badge"></span>
  <div class="desc" id="detail-desc"></div>
  <div class="connections">
    Connections (<span id="detail-conn-count">0</span>)
    <div class="conn-list" id="detail-connections"></div>
  </div>
</div>

<div class="stats">
  <span>Nodes: <strong id="stat-nodes">0</strong></span>
  <span>Edges: <strong id="stat-edges">0</strong></span>
  <span>Clusters: <strong id="stat-clusters">0</strong></span>
  <span>Domains: <strong id="stat-domains">7</strong></span>
  <span>Papers: <strong id="stat-papers">12</strong></span>
</div>

<div class="tooltip" id="tooltip"></div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// ═══════════════════════════════════════════════════════════════
//  CHARLOTTE RESEARCH LAB — THE ENTIRE PROJECT AS A KNOWLEDGE GRAPH
//  Every project, paper, domain, concept, and primitive as nodes.
//  Every relationship as edges. This IS the substrate.
// ═══════════════════════════════════════════════════════════════

const COLORS = {
  primitive: '#bc8cff',
  cluster:   '#3fb950',
  domain:    '#f85149',
  paper:     '#d29922',
  project:   '#58a6ff',
  discipline:'#39d2c0'
};

const BADGE_CSS = {
  primitive: 'background:rgba(188,140,255,0.15);color:#bc8cff',
  cluster:   'background:rgba(63,185,80,0.15);color:#3fb950',
  domain:    'background:rgba(248,81,73,0.15);color:#f85149',
  paper:     'background:rgba(210,153,34,0.15);color:#d29922',
  project:   'background:rgba(88,166,255,0.15);color:#58a6ff',
  discipline:'background:rgba(57,210,192,0.15);color:#39d2c0'
};

const TYPE_LABELS = {
  primitive: 'Primitives',
  cluster: 'Concept Clusters',
  domain: 'Validation Domains',
  paper: 'Research Papers',
  project: 'Projects',
  discipline: 'Disciplines'
};

// ─── NODES ────────────────────────────────────────────────────

const nodes = [
  // ── Charlotte's Five Primitives ──
  { id:'NODE',     type:'primitive', label:'NODE',     desc:'Identity — any uniquely identifiable entity that exists in the graph. Every instrument, person, animal, machine, and UI element is a NODE.' , size:22},
  { id:'EDGE',     type:'primitive', label:'EDGE',     desc:'Relationship — typed connection between two nodes. Ownership, lineage, dependency, causation, co-occurrence.' , size:22},
  { id:'METRIC',   type:'primitive', label:'METRIC',   desc:'Quantitative signal — any measurable property of a node. Price, weight, volume, temperature, genetic index.' , size:22},
  { id:'SIGNAL',   type:'primitive', label:'SIGNAL',   desc:'Event — a timestamped observation emitted by a node. Transactions, measurements, status changes, behavioral events.' , size:22},
  { id:'PROTOCOL', type:'primitive', label:'PROTOCOL', desc:'Rule — business logic, constraints, and behavioral contracts. Buy-below-retail, breed-for-index, automate-on-signal.' , size:22},

  // ── Concept Clusters ──
  { id:'c-bio',    type:'cluster', label:'Biomimicry',             desc:'Learning from biological systems: organisms as signal emitters, evolution as optimization, nature as engineer.', size:18},
  { id:'c-st',     type:'cluster', label:'Space-Time',             desc:'Pre-built spatiotemporal substrate: space and time as graph geometry, not schema. Coordinates, intervals, topology.', size:18},
  { id:'c-swarm',  type:'cluster', label:'Swarm & Emergence',      desc:'Multi-agent coordination, flocking, self-organization through local signal propagation. Intelligence from simplicity.', size:18},
  { id:'c-kg',     type:'cluster', label:'Knowledge Graphs',       desc:'Graph theory, formal logic, ontology — knowledge as traversable structure. The core architecture.', size:18},
  { id:'c-neuro',  type:'cluster', label:'Neural & Cognitive',     desc:'Brain as knowledge graph, cognition as signal processing, neural geometry. How minds navigate information.', size:16},
  { id:'c-sig',    type:'cluster', label:'Signal Processing',      desc:'All data as signals: frequency analysis, temporal patterns, waveform decomposition. Charlotte\'s fundamental view of reality.', size:16},
  { id:'c-life',   type:'cluster', label:'Lifecycle & Learning',   desc:'Complete trajectories: breeding paths, career arcs, instrument provenance, business cycles. The dead teach the living.', size:16},
  { id:'c-ops',    type:'cluster', label:'Strategy & Operations',  desc:'Operational planning as graph traversal: deployment, resource allocation, system design. Business as substrate.', size:16},
  { id:'c-ui',     type:'cluster', label:'Interface & Design',     desc:'Frontend as graph: UI as navigation through knowledge space, component architecture, visual systems.', size:14},
  { id:'c-game',   type:'cluster', label:'Game Mechanics',         desc:'State machines, search algorithms, adversarial AI — games as computational probes for Charlotte\'s architecture.', size:14},

  // ── Validation Domains ──
  { id:'d-ll',  type:'domain', label:'LineLeap',                desc:'Human/social — venue experience platform, 100-employee operation. Proof Charlotte automates entire business operations. Strategy hub.', size:17},
  { id:'d-isg', type:'domain', label:'Industrial Service Group', desc:'Mechanical/industrial — rotating equipment, service logistics. ServiceIQ ($1.4M live Feb 23, 2026). First Charlotte production revenue.', size:17},
  { id:'d-vio', type:'domain', label:'Prier Violins',           desc:'Cultural/artisan — PPP Instruments LLC, $5.3M rare instrument portfolio, 32 tracked turns. Provenance as knowledge graph.', size:16},
  { id:'d-ttm', type:'domain', label:'Top Tier Moving',         desc:'Commercial/logistics — 10,606 jobs, 98 crew, $14.4M billed across 52 states. Operations as signal stream.', size:16},
  { id:'d-con', type:'domain', label:'Constellation',            desc:'Knowledge/memory — 1,754 images to 3D knowledge graph. Journey Brain. Visual signal extraction. Personal archaeology.', size:16},
  { id:'d-snd', type:'domain', label:'Sounder / Trogdon',       desc:'Biological — bioacoustic monitoring, swine genetics, 27,200 nodes / 46,100 edges production dataset. The proving ground.', size:17},
  { id:'d-sea', type:'domain', label:'Sea Lion',                 desc:'Marine/biological — ocean science, marine ecosystem monitoring, animal behavior signals.', size:14},

  // ── Research Papers ──
  { id:'p0',  type:'paper', label:'Paper 0: Synthesis',    desc:'Infrastructure for Observable Reality — Nature/Science. The foundational claim: Charlotte models any domain where identities emit signals over time.', size:15},
  { id:'p1',  type:'paper', label:'Paper 1: FINN',         desc:'Signal-Based Temporal Graph Architecture — IEEE TKDE. The data model: everything is a FACT, five types, register-based, append-only.', size:14},
  { id:'p2',  type:'paper', label:'Paper 2: Business',     desc:'Operational Infrastructure for Signal-Driven Industries — Management Science. The business case: embedded service, not SaaS.', size:13},
  { id:'p3',  type:'paper', label:'Paper 3: Swarm',        desc:'Recursive Flocking: Swarm Intelligence for KG Coordination — Swarm Intelligence Journal. Multi-agent knowledge discovery.', size:13},
  { id:'p4',  type:'paper', label:'Paper 4: Substrate',    desc:'Containerized KGs with Register-Based Primitives — IEEE Software. The software architecture: containerized, pre-built, universal.', size:13},
  { id:'p5',  type:'paper', label:'Paper 5: Domain',       desc:'Universal Ontology Through Register-Based Primitives — ACM MODELS. One model for every domain. Five primitives, infinite expression.', size:13},
  { id:'p6',  type:'paper', label:'Paper 6: Spatial',      desc:'Interwoven Spatial Planes in Knowledge Graphs — ACM SIGSPATIAL. Space as pre-built graph substrate, not after-the-fact schema.', size:12},
  { id:'p7',  type:'paper', label:'Paper 7: Temporal',     desc:'Time as Graph: Temporal Substrate Architecture — ACM TODS. Time is not metadata. Time is structure.', size:12},
  { id:'p8',  type:'paper', label:'Paper 8: Frontend',     desc:'The Serialized Interface: UI as KG Traversals — ACM CHI/UIST. Every screen is a subgraph. Every click is a traversal.', size:12},
  { id:'p9',  type:'paper', label:'Paper 9: Tesseract',    desc:'Tesseract Topology: 4D Navigation Through Knowledge Space — ACM SoCG. Higher-dimensional knowledge geometry.', size:12},
  { id:'p10', type:'paper', label:'Paper 10: Lifecycle',   desc:'The Dead Teach the Living: Lifecycle Ensemble Learning — NeurIPS/ICML. Completed trajectories as training data for the living.', size:13},
  { id:'p11', type:'paper', label:'Paper 11: Harmonic',    desc:'Harmonic Resonance: Folding Time Across Generations — Cognitive Science/PNAS. Temporal patterns that echo across generations.', size:12},

  // ── Disciplines ──
  { id:'disc-math',   type:'discipline', label:'Mathematics',       desc:'Topology, algebra, geometry, combinatorics — the structural foundations of everything Charlotte builds on.', size:12},
  { id:'disc-cs',     type:'discipline', label:'Computer Science',   desc:'Algorithms, data structures, distributed systems, AI/ML — the implementation substrate.', size:12},
  { id:'disc-bio',    type:'discipline', label:'Biology',            desc:'Genetics, ecology, behavior, evolution, marine science — nature as the original knowledge graph.', size:12},
  { id:'disc-phys',   type:'discipline', label:'Physics',            desc:'Signals, waves, dynamics, chaos, thermodynamics — the mechanics of observable reality.', size:11},
  { id:'disc-biz',    type:'discipline', label:'Business',           desc:'Operations, strategy, finance, management, PE — the economic substrate Charlotte enables.', size:11},
  { id:'disc-cog',    type:'discipline', label:'Cognitive Science',  desc:'Perception, memory, attention, neural computation — how minds navigate knowledge graphs.', size:11},
  { id:'disc-design', type:'discipline', label:'Design',             desc:'UI/UX, atomic design, information architecture — the visible surface of graph traversal.', size:10},

  // ── Projects: Games & Interactive ──
  { id:'g-2048',    type:'project', label:'2048',               desc:'Number merging puzzle — state space search, merge logic, score optimization.', size:6},
  { id:'g-ats',     type:'project', label:'Against the Storm',  desc:'Settlement companion — resource chains, species, needs management. Complex state tracking.', size:6},
  { id:'g-block',   type:'project', label:'Block Dude',         desc:'Puzzle platformer — spatial reasoning, pathfinding, level design.', size:6},
  { id:'g-chess',   type:'project', label:'Chess',              desc:'AI opponent — minimax, board evaluation, game tree search, alpha-beta pruning.', size:7},
  { id:'g-go',      type:'project', label:'Go',                 desc:'Territory control — emergent complexity, Monte Carlo tree search, pattern recognition.', size:7},
  { id:'g-maple',   type:'project', label:'MapleStory Bazaar',  desc:'Vendor marketplace — multi-channel economics, inventory, pricing simulation.', size:6},
  { id:'g-mine',    type:'project', label:'Minesweeper',        desc:'Logic game — constraint propagation, probability estimation, search.', size:6},
  { id:'g-pong',    type:'project', label:'Pong',               desc:'Arcade physics — real-time state, collision, AI opponent tracking.', size:6},
  { id:'g-snake',   type:'project', label:'Snake',              desc:'Growth dynamics — path planning, collision detection, growing state.', size:6},
  { id:'g-sol',     type:'project', label:'Solitaire',          desc:'Glassmorphism cards — sorting, stacking, constraint satisfaction, visual design.', size:6},
  { id:'g-sudoku',  type:'project', label:'Sudoku',             desc:'Constraint satisfaction — backtracking, arc consistency, difficulty generation.', size:6},
  { id:'g-tetris',  type:'project', label:'Tetris',             desc:'Spatial packing — real-time decision under pressure, piece rotation, line clearing.', size:6},
  { id:'g-ttt',     type:'project', label:'Tic Tac Toe',        desc:'Minimax — complete game tree, optimal play, introductory adversarial search.', size:5},
  { id:'g-star',    type:'project', label:'BITWISE',             desc:'Binary lockpicking — bit manipulation, ring navigation, logic puzzles.', size:6},

  // ── Projects: Visualization & Math ──
  { id:'v-chaos',   type:'project', label:'Chaos Theory',       desc:'12 systems: Lorenz, Mandelbrot, bifurcation, pendulum, L-systems, Barnsley, automata.', size:8},
  { id:'v-fourier', type:'project', label:'Fourier Transform',  desc:'Epicycles, DFT, signal decomposition, spirographs, drawing mode.', size:8},
  { id:'v-hex',     type:'project', label:'Hex Grid',           desc:'Hexagonal geometry — coordinates, neighbors, distance, rings, pathfinding.', size:7},
  { id:'v-sacred',  type:'project', label:'Sacred Geometry',    desc:'Flower of Life, Metatron\'s Cube, Sri Yantra, golden ratio, fibonacci spiral.', size:7},
  { id:'v-tsp',     type:'project', label:'TSP Visualizer',     desc:'Nearest neighbor, 2-opt, genetic, ant colony, simulated annealing. NP-hard optimization.', size:8},
  { id:'v-iso',     type:'project', label:'Isometric Builder',  desc:'2.5D tile editor — spatial manipulation, elevation, paint, terrain building.', size:7},
  { id:'v-swarm',   type:'project', label:'Swarm Viz',          desc:'Boids flocking — separation, alignment, cohesion in 2D and 3D. Emergence from simple rules.', size:8},

  // ── Projects: Neural / ML ──
  { id:'n-cnn',     type:'project', label:'CNN 3D',             desc:'3D convolutional neural network visualization — layer exploration, activation maps.', size:7},
  { id:'n-play',    type:'project', label:'Neural Playground',  desc:'Browser neural network trainer — real-time learning, parameter tuning, topology design.', size:7},

  // ── Projects: Scientific References ──
  { id:'r-bioarch',  type:'project', label:'Bio-Architecture',      desc:'Termite ventilation, shell structures, adaptive facades, tensegrity.', size:6},
  { id:'r-biorobot', type:'project', label:'Bio-Robotics',          desc:'Soft robotics, legged robots, aerial robots, swarm systems.', size:6},
  { id:'r-bioloco',  type:'project', label:'Bio-Locomotion',        desc:'Flight, swimming, terrestrial movement, collective motion.', size:6},
  { id:'r-bioopt',   type:'project', label:'Bio-Optics',            desc:'Structural color, bioluminescence, compound eyes, camouflage.', size:6},
  { id:'r-biosurf',  type:'project', label:'Bio-Surfaces',          desc:'Gecko adhesion, shark skin, lotus effect, superhydrophobicity.', size:6},
  { id:'r-biomat',   type:'project', label:'Biomimetic Materials',  desc:'Self-healing, shape memory, bio-adhesives, hierarchical composites.', size:6},
  { id:'r-biomim',   type:'project', label:'Biomimicry',            desc:'Core principles, methodology, case studies. The master reference.', size:7},
  { id:'r-cogsci',   type:'project', label:'Cognitive Science',     desc:'Predictive coding, neural oscillations, Bayesian brain, embodied cognition.', size:7},
  { id:'r-eco',      type:'project', label:'Ecological Systems',    desc:'Circular economy, industrial ecology, regenerative design.', size:6},
  { id:'r-ento',     type:'project', label:'Entomology',            desc:'Insect biology, pollination, pest science, biomimicry applications.', size:6},
  { id:'r-logic',    type:'project', label:'Formal Logic',          desc:'Propositional, predicate, modal, lambda calculus, Lisp foundations.', size:7},
  { id:'r-graph',    type:'project', label:'Graph Theory',          desc:'Databases, knowledge graphs, ontologies, temporal data. Charlotte\'s mother discipline.', size:8},
  { id:'r-live',     type:'project', label:'Livestock Science',     desc:'Genetics, breeding, reproduction, nutrition, show industry.', size:7},
  { id:'r-nalgo',    type:'project', label:'Nature-Inspired Algos', desc:'Evolutionary computation, swarm intelligence, immune systems, neural models.', size:7},
  { id:'r-neuro',    type:'project', label:'Neuroscience',          desc:'Neural geometry, brain topology, connectomics, oscillatory dynamics.', size:7},
  { id:'r-sig',      type:'project', label:'Signal Processing',     desc:'Time series, frequency analysis, waveforms, spectral methods.', size:7},
  { id:'r-spatial',  type:'project', label:'Spatial Computing',     desc:'GIS, spatial databases, geospatial algorithms, coordinate systems.', size:7},
  { id:'r-spider',   type:'project', label:'Spider Silk',           desc:'Silk biology, arachnid husbandry, biomaterials, web architecture.', size:6},
  { id:'r-struct',   type:'project', label:'Structural Biomimetics',desc:'Nacre, bone, silk, wood — hierarchical natural design principles.', size:6},
  { id:'r-swarm',    type:'project', label:'Swarm Intelligence',    desc:'Flocking, emergence, self-organization, multi-agent systems. The reference.', size:7},
  { id:'r-sysarch',  type:'project', label:'Systems Architecture',  desc:'Distributed systems, DDD, event-driven, serverless, microservices.', size:7},
  { id:'r-temp',     type:'project', label:'Temporal Databases',    desc:'Event sourcing, bitemporal, time-series, temporal logic.', size:7},
  { id:'r-topo',     type:'project', label:'Topology',              desc:'Point-set, algebraic, TDA, higher dimensions, manifolds, knots.', size:7},

  // ── Projects: Design / UI ──
  { id:'u-pixel',  type:'project', label:'Pixel Art Editor',    desc:'Full editor with pencil, eraser, line, fill — menu system, export.', size:6},
  { id:'u-comp',   type:'project', label:'Component Showcase',  desc:'Material 3 + atomic design — comprehensive component library.', size:6},
  { id:'u-neu',    type:'project', label:'Neumorphism',         desc:'Soft UI components — neumorphic design + atomic methodology.', size:6},

  // ── Projects: Domain Tools ──
  { id:'t-pig',    type:'project', label:'Pig Breeder',         desc:'PorkPal — swine herd management, breeding, genetics, litters, export.', size:7},
  { id:'t-show',   type:'project', label:'Show Animal Tree',    desc:'PoE-style skill tree — lifecycle planning for swine, cattle, sheep, goat.', size:7},
  { id:'t-hoshin', type:'project', label:'Hoshin Kanri',        desc:'Japanese strategy deployment — policy deployment, X-matrix, catchball.', size:7},

  // ── Substrate (the existing KG explorer) ──
  { id:'t-sub',    type:'project', label:'Substrate Explorer',  desc:'The original Charlotte KG explorer — FACT types, register inspection, timeline, table views.', size:8},
];

// ─── EDGES ────────────────────────────────────────────────────

const edges = [
  // === Primitives → Concept Clusters ===
  {s:'NODE',     t:'c-kg',    w:0.8}, {s:'NODE',     t:'c-life', w:0.7},
  {s:'EDGE',     t:'c-kg',    w:0.8}, {s:'EDGE',     t:'c-st',   w:0.6},
  {s:'METRIC',   t:'c-sig',   w:0.8}, {s:'METRIC',   t:'c-life', w:0.6},
  {s:'SIGNAL',   t:'c-sig',   w:0.9}, {s:'SIGNAL',   t:'c-swarm',w:0.6}, {s:'SIGNAL', t:'c-neuro', w:0.5},
  {s:'PROTOCOL', t:'c-ops',   w:0.8}, {s:'PROTOCOL', t:'c-swarm',w:0.5},

  // === Primitives → Domains (every domain uses all 5) ===
  ...['d-ll','d-isg','d-vio','d-ttm','d-con','d-snd','d-sea'].flatMap(d => [
    {s:'NODE',t:d,w:0.25}, {s:'SIGNAL',t:d,w:0.25}
  ]),

  // === Primitives → Key Papers ===
  {s:'NODE',t:'p0',w:0.7}, {s:'EDGE',t:'p0',w:0.7}, {s:'METRIC',t:'p0',w:0.7},
  {s:'SIGNAL',t:'p1',w:0.9}, {s:'PROTOCOL',t:'p4',w:0.8}, {s:'NODE',t:'p5',w:0.8},

  // === Papers → Clusters ===
  {s:'p0', t:'c-kg',w:0.7},
  {s:'p1', t:'c-sig',w:0.9},   {s:'p1', t:'c-st',w:0.6},
  {s:'p2', t:'c-ops',w:0.9},
  {s:'p3', t:'c-swarm',w:0.9},
  {s:'p4', t:'c-ops',w:0.6},   {s:'p4', t:'c-kg',w:0.7},
  {s:'p5', t:'c-kg',w:0.9},
  {s:'p6', t:'c-st',w:0.9},
  {s:'p7', t:'c-st',w:0.9},
  {s:'p8', t:'c-ui',w:0.8},    {s:'p8', t:'c-kg',w:0.6},
  {s:'p9', t:'c-st',w:0.8},
  {s:'p10',t:'c-life',w:0.9},
  {s:'p11',t:'c-neuro',w:0.7}, {s:'p11',t:'c-sig',w:0.7},

  // === Papers → Domains ===
  {s:'p0', t:'d-ll',w:0.5}, {s:'p0', t:'d-snd',w:0.5}, {s:'p0', t:'d-isg',w:0.5}, {s:'p0', t:'d-vio',w:0.5},
  {s:'p2', t:'d-ll',w:0.7}, {s:'p2', t:'d-isg',w:0.7},
  {s:'p3', t:'d-snd',w:0.6},
  {s:'p5', t:'d-vio',w:0.5}, {s:'p5', t:'d-ttm',w:0.5},
  {s:'p10',t:'d-snd',w:0.8}, {s:'p10',t:'d-vio',w:0.5},
  {s:'p11',t:'d-con',w:0.5},

  // === Clusters → Disciplines ===
  {s:'c-bio',  t:'disc-bio',w:0.9},
  {s:'c-st',   t:'disc-math',w:0.8},  {s:'c-st',   t:'disc-phys',w:0.5},
  {s:'c-swarm',t:'disc-cs',w:0.7},    {s:'c-swarm',t:'disc-bio',w:0.5},
  {s:'c-kg',   t:'disc-cs',w:0.8},    {s:'c-kg',   t:'disc-math',w:0.6},
  {s:'c-neuro',t:'disc-cog',w:0.9},   {s:'c-neuro',t:'disc-bio',w:0.5},
  {s:'c-sig',  t:'disc-phys',w:0.7},  {s:'c-sig',  t:'disc-cs',w:0.5},
  {s:'c-life', t:'disc-bio',w:0.6},   {s:'c-life', t:'disc-biz',w:0.6},
  {s:'c-ops',  t:'disc-biz',w:0.9},   {s:'c-ops',  t:'disc-cs',w:0.4},
  {s:'c-ui',   t:'disc-design',w:0.9},{s:'c-ui',   t:'disc-cs',w:0.4},
  {s:'c-game', t:'disc-cs',w:0.7},    {s:'c-game', t:'disc-math',w:0.5},

  // === Projects → Clusters ===
  // Biomimicry
  ...['r-bioarch','r-biorobot','r-bioloco','r-bioopt','r-biosurf','r-biomat','r-biomim','r-spider','r-struct','r-ento'].map(p=>({s:p,t:'c-bio',w:0.65})),
  // Space-Time
  ...['v-hex','v-sacred','r-spatial','r-temp','r-topo','v-iso'].map(p=>({s:p,t:'c-st',w:0.65})),
  // Swarm
  ...['r-swarm','v-swarm','r-nalgo','v-tsp'].map(p=>({s:p,t:'c-swarm',w:0.65})),
  // Knowledge Graphs
  ...['r-graph','r-logic','r-sysarch','t-sub'].map(p=>({s:p,t:'c-kg',w:0.65})),
  // Neural/Cognitive
  ...['n-cnn','n-play','r-neuro','r-cogsci'].map(p=>({s:p,t:'c-neuro',w:0.65})),
  // Signals
  ...['v-fourier','r-sig','v-chaos'].map(p=>({s:p,t:'c-sig',w:0.65})),
  // Lifecycle
  ...['r-live','t-pig','t-show'].map(p=>({s:p,t:'c-life',w:0.65})),
  // Strategy/Ops
  ...['t-hoshin','r-sysarch'].map(p=>({s:p,t:'c-ops',w:0.55})),
  // Design/UI
  ...['u-comp','u-neu','u-pixel'].map(p=>({s:p,t:'c-ui',w:0.65})),
  // Games
  ...['g-chess','g-go','g-2048','g-block','g-mine','g-pong','g-snake','g-sol','g-sudoku','g-tetris','g-ttt','g-star','g-ats','g-maple'].map(p=>({s:p,t:'c-game',w:0.55})),

  // === Cross-cluster (interesting relationships) ===
  {s:'r-spider',t:'c-swarm',w:0.4}, {s:'r-ento',t:'c-swarm',w:0.35},
  {s:'v-chaos',t:'c-st',w:0.4},     {s:'v-tsp',t:'c-st',w:0.3},
  {s:'g-chess',t:'c-kg',w:0.3},     {s:'g-go',t:'c-swarm',w:0.3},
  {s:'r-eco',t:'c-bio',w:0.5},      {s:'r-eco',t:'c-life',w:0.4},
  {s:'r-cogsci',t:'c-sig',w:0.4},   {s:'r-neuro',t:'c-sig',w:0.3},
  {s:'r-topo',t:'c-kg',w:0.4},      {s:'v-sacred',t:'c-neuro',w:0.2},
  {s:'g-ats',t:'c-ops',w:0.3},      {s:'g-maple',t:'c-ops',w:0.25},
  {s:'t-sub',t:'c-sig',w:0.5},      {s:'t-sub',t:'c-st',w:0.4},

  // === Domains → Projects (direct) ===
  {s:'d-snd',t:'r-live',w:0.7}, {s:'d-snd',t:'t-pig',w:0.8}, {s:'d-snd',t:'t-show',w:0.7},
  {s:'d-sea',t:'c-bio',w:0.5},
  {s:'d-con',t:'c-kg',w:0.7},  {s:'d-con',t:'c-sig',w:0.5},
  {s:'d-ll', t:'c-ops',w:0.7},
  {s:'d-isg',t:'c-life',w:0.6},{s:'d-isg',t:'c-ops',w:0.7},
  {s:'d-vio',t:'c-life',w:0.7},
  {s:'d-ttm',t:'c-life',w:0.6},{s:'d-ttm',t:'c-ops',w:0.5},

  // === Inter-domain (shared substrate proves universality) ===
  {s:'d-ll', t:'d-isg',w:0.3}, {s:'d-snd',t:'d-sea',w:0.4},
  {s:'d-vio',t:'d-ttm',w:0.2}, {s:'d-ll', t:'d-ttm',w:0.2},
  {s:'d-snd',t:'d-vio',w:0.15},
].map(e => ({ source: e.s, target: e.t, strength: e.w }));

// ═══════════════════════════════════════════════════════════════
//  D3 FORCE-DIRECTED GRAPH
// ═══════════════════════════════════════════════════════════════

const W = window.innerWidth;
const H = window.innerHeight;
const nodeMap = new Map(nodes.map(n => [n.id, n]));

// Stats
const typeCount = {};
nodes.forEach(n => { typeCount[n.type] = (typeCount[n.type]||0) + 1; });
document.getElementById('node-count').textContent = nodes.length;
document.getElementById('edge-count').textContent = edges.length;
document.getElementById('stat-nodes').textContent = nodes.length;
document.getElementById('stat-edges').textContent = edges.length;
document.getElementById('stat-clusters').textContent = typeCount.cluster || 0;

// Legend
const legendEl = document.getElementById('legend');
legendEl.innerHTML = '<h3>Node Types</h3>' +
  Object.entries(TYPE_LABELS).map(([type,label]) =>
    `<div class="legend-item" onclick="filterByType('${type}')"><span class="legend-dot" style="background:${COLORS[type]}"></span>${label} (${typeCount[type]||0})</div>`
  ).join('');

// Filter buttons
const filterTypes = ['all','primitive','cluster','domain','paper','project','discipline'];
const filtersEl = document.getElementById('filters');
filterTypes.forEach(t => {
  const btn = document.createElement('button');
  btn.className = 'filter-btn' + (t==='all'?' active':'');
  btn.textContent = (t==='all'?'All':TYPE_LABELS[t]||t) + (t!=='all'?` (${typeCount[t]||0})`:'');
  btn.dataset.type = t;
  btn.onclick = () => filterByType(t);
  filtersEl.appendChild(btn);
});

let activeFilter = 'all';

function filterByType(type) {
  activeFilter = type;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.dataset.type===type));
  node.attr('opacity', d => (type==='all' || d.type===type) ? 1 : 0.06);
  label.attr('opacity', d => {
    if (type==='all') return d.type!=='project' ? 1 : 0;
    return d.type===type ? 1 : 0;
  });
  link.attr('opacity', d => {
    if (type==='all') return Math.max(0.06, d.strength * 0.25);
    const sn = typeof d.source === 'object' ? d.source : nodeMap.get(d.source);
    const tn = typeof d.target === 'object' ? d.target : nodeMap.get(d.target);
    return (sn?.type===type || tn?.type===type) ? 0.5 : 0.015;
  });
}

// SVG
const svg = d3.select('#graph').attr('width',W).attr('height',H);
const g = svg.append('g');

// Zoom
const zoomBehavior = d3.zoom()
  .scaleExtent([0.15, 5])
  .on('zoom', e => g.attr('transform', e.transform));
svg.call(zoomBehavior);
svg.call(zoomBehavior.transform, d3.zoomIdentity.translate(W/2, H/2).scale(0.85).translate(-W/2, -H/2));

// Glow filter
const defs = svg.append('defs');
const glow = defs.append('filter').attr('id','glow').attr('x','-50%').attr('y','-50%').attr('width','200%').attr('height','200%');
glow.append('feGaussianBlur').attr('stdDeviation','4').attr('result','blur');
const merge = glow.append('feMerge');
merge.append('feMergeNode').attr('in','blur');
merge.append('feMergeNode').attr('in','SourceGraphic');

// Simulation
const sim = d3.forceSimulation(nodes)
  .force('link', d3.forceLink(edges).id(d=>d.id)
    .distance(d => {
      const sn = nodeMap.get(typeof d.source==='object'?d.source.id:d.source);
      const tn = nodeMap.get(typeof d.target==='object'?d.target.id:d.target);
      const big = Math.max(sn?.size||5, tn?.size||5);
      return 50 + (22 - big) * 5;
    })
    .strength(d => d.strength * 0.35))
  .force('charge', d3.forceManyBody().strength(d => -60 - d.size * 10))
  .force('center', d3.forceCenter(W/2, H/2).strength(0.04))
  .force('collision', d3.forceCollide().radius(d => d.size + 3))
  .force('x', d3.forceX(W/2).strength(0.015))
  .force('y', d3.forceY(H/2).strength(0.015));

// Links
const link = g.append('g').selectAll('line').data(edges).join('line')
  .attr('stroke', '#1e2a3a')
  .attr('stroke-width', d => Math.max(0.5, d.strength * 1.8))
  .attr('opacity', d => Math.max(0.06, d.strength * 0.25));

// Nodes
const node = g.append('g').selectAll('circle').data(nodes).join('circle')
  .attr('r', d => d.size)
  .attr('fill', d => COLORS[d.type])
  .attr('stroke', d => d.type==='primitive' ? COLORS.primitive : 'none')
  .attr('stroke-width', d => d.type==='primitive' ? 3 : 0)
  .attr('filter', d => d.type==='primitive' ? 'url(#glow)' : null)
  .attr('opacity', 1)
  .style('cursor', 'pointer')
  .call(d3.drag().on('start',ds).on('drag',dd).on('end',de))
  .on('click', (e,d) => showDetail(d))
  .on('mouseover', (e,d) => {
    tooltip.style.display='block';
    tooltip.style.left=(e.clientX+14)+'px';
    tooltip.style.top=(e.clientY-10)+'px';
    tooltip.innerHTML=`<strong>${d.label}</strong><br><span style="color:${COLORS[d.type]};font-size:10px">${d.type.toUpperCase()}</span>`;
  })
  .on('mousemove', e => {
    tooltip.style.left=(e.clientX+14)+'px';
    tooltip.style.top=(e.clientY-10)+'px';
  })
  .on('mouseout', () => { tooltip.style.display='none'; });

// Labels
const label = g.append('g').selectAll('text').data(nodes).join('text')
  .text(d => d.label)
  .attr('font-size', d => Math.max(7, d.size * 0.65))
  .attr('fill', d => COLORS[d.type])
  .attr('text-anchor','middle')
  .attr('dy', d => d.size + 11)
  .attr('opacity', d => d.type!=='project' ? 1 : 0)
  .attr('pointer-events','none')
  .attr('font-family','-apple-system, sans-serif')
  .attr('font-weight', d => d.type==='primitive' ? 700 : 400);

const tooltip = document.getElementById('tooltip');

// Tick
sim.on('tick', () => {
  link.attr('x1',d=>d.source.x).attr('y1',d=>d.source.y).attr('x2',d=>d.target.x).attr('y2',d=>d.target.y);
  node.attr('cx',d=>d.x).attr('cy',d=>d.y);
  label.attr('x',d=>d.x).attr('y',d=>d.y);
});

// Drag
function ds(e,d) { if(!e.active) sim.alphaTarget(0.3).restart(); d.fx=d.x; d.fy=d.y; }
function dd(e,d) { d.fx=e.x; d.fy=e.y; }
function de(e,d) { if(!e.active) sim.alphaTarget(0); d.fx=null; d.fy=null; }

// ─── DETAIL PANEL ─────────────────────────────────────────────

function showDetail(d) {
  const panel = document.getElementById('detail');
  panel.classList.add('open');
  document.getElementById('detail-name').textContent = d.label;
  const badge = document.getElementById('detail-badge');
  badge.textContent = d.type.toUpperCase();
  badge.style.cssText = BADGE_CSS[d.type] || '';
  document.getElementById('detail-desc').textContent = d.desc;

  const connected = [];
  edges.forEach(e => {
    const sid = typeof e.source==='object' ? e.source.id : e.source;
    const tid = typeof e.target==='object' ? e.target.id : e.target;
    if (sid===d.id) { const n=nodeMap.get(tid); if(n) connected.push(n); }
    else if (tid===d.id) { const n=nodeMap.get(sid); if(n) connected.push(n); }
  });

  document.getElementById('detail-conn-count').textContent = connected.length;
  document.getElementById('detail-connections').innerHTML = connected
    .sort((a,b) => b.size-a.size)
    .map(c => `<div class="conn-item" onclick="focusNode('${c.id}')"><span class="conn-dot" style="background:${COLORS[c.type]}"></span>${c.label}</div>`)
    .join('');

  highlightNode(d);
}

function closeDetail() {
  document.getElementById('detail').classList.remove('open');
  filterByType(activeFilter);
  link.attr('stroke','#1e2a3a');
}

function focusNode(id) {
  const n = nodes.find(n => n.id===id);
  if (!n) return;
  showDetail(n);
  const t = d3.zoomTransform(svg.node());
  svg.transition().duration(500).call(zoomBehavior.transform,
    d3.zoomIdentity.translate(W/2 - n.x*t.k, H/2 - n.y*t.k).scale(t.k));
}

function highlightNode(d) {
  const ids = new Set([d.id]);
  edges.forEach(e => {
    const sid = typeof e.source==='object'?e.source.id:e.source;
    const tid = typeof e.target==='object'?e.target.id:e.target;
    if(sid===d.id) ids.add(tid);
    if(tid===d.id) ids.add(sid);
  });
  node.attr('opacity', n => ids.has(n.id) ? 1 : 0.05);
  label.attr('opacity', n => ids.has(n.id) ? 1 : 0.03);
  link.attr('opacity', e => {
    const sid = typeof e.source==='object'?e.source.id:e.source;
    const tid = typeof e.target==='object'?e.target.id:e.target;
    return (sid===d.id||tid===d.id) ? 0.7 : 0.015;
  }).attr('stroke', e => {
    const sid = typeof e.source==='object'?e.source.id:e.source;
    const tid = typeof e.target==='object'?e.target.id:e.target;
    return (sid===d.id||tid===d.id) ? COLORS[d.type] : '#1e2a3a';
  });
}

// ─── SEARCH ───────────────────────────────────────────────────

document.getElementById('search').addEventListener('input', e => {
  const q = e.target.value.toLowerCase();
  if (!q) { filterByType(activeFilter); link.attr('stroke','#1e2a3a'); return; }
  const hits = new Set();
  nodes.forEach(n => {
    if (n.label.toLowerCase().includes(q) || n.desc.toLowerCase().includes(q)) hits.add(n.id);
  });
  node.attr('opacity', n => hits.has(n.id) ? 1 : 0.04);
  label.attr('opacity', n => hits.has(n.id) ? 1 : 0.02);
  link.attr('opacity', 0.02);
});

// Escape
document.addEventListener('keydown', e => {
  if (e.key==='Escape') {
    closeDetail();
    document.getElementById('search').value='';
    filterByType(activeFilter);
    link.attr('stroke','#1e2a3a');
  }
});

// Resize
window.addEventListener('resize', () => {
  const w=window.innerWidth, h=window.innerHeight;
  svg.attr('width',w).attr('height',h);
  sim.force('center', d3.forceCenter(w/2,h/2));
  sim.alpha(0.1).restart();
});
</script>
</body>
</html>
